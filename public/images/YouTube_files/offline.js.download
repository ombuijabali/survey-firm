(function(g){var window=this;'use strict';var llM=function(e){var L=new g.MB("und",new g.b2("Default","und",!0));L.captionTracks=e.captionTracks;return L},Pg7=function(e){return new g.iq(function(L,c){var I=e.length,B=[];
if(I)for(var x=function(u,t){I--;B[u]=t;I==0&&L(B)},S=function(u){c(u)},h,R=0;R<e.length;R++)h=e[R],g.QXf(h,g.u7(x,R),S);
else L(B)})},mw=function(e){this.X=e},ys=function(){mw.apply(this,arguments)},QS7=function(){ys.apply(this,arguments)},d_e=function(){ys.apply(this,arguments)},U_7=function(){ys.apply(this,arguments)},E6w=function(){ys.apply(this,arguments)},Xsg=function(){ys.apply(this,arguments)},K89=function(){ys.apply(this,arguments)},Y6N=function(){mw.apply(this,arguments)},n6h=function(){ys.apply(this,arguments)},eZZ=function(){ys.apply(this,arguments)},LVh=function(){ys.apply(this,arguments)},cvh=function(){ys.apply(this,
arguments)},IHw=function(){ys.apply(this,arguments)},BQ9=function(){ys.apply(this,arguments)},xzM=function(){ys.apply(this,arguments)},oMh=function(){ys.apply(this,arguments)},SBN=function(){ys.apply(this,arguments)},rvh=function(){ys.apply(this,arguments)},hZM=function(){ys.apply(this,arguments)},RZh=function(){ys.apply(this,arguments)},uyg=function(){mw.apply(this,arguments)},tOU=function(){ys.apply(this,arguments)},OS9=function(){ys.apply(this,arguments)},qBw=function(){ys.apply(this,arguments)},
TQe=function(){ys.apply(this,arguments)},WVM=function(){ys.apply(this,arguments)},MOg=function(){ys.apply(this,arguments)},zZM=function(){ys.apply(this,arguments)},sjN=function(){ys.apply(this,arguments)},vMN=function(){ys.apply(this,arguments)},fHL=function(){mw.apply(this,arguments)},AvM=function(){mw.apply(this,arguments)},FVe=function(){mw.apply(this,arguments)},bSN=function(){ys.apply(this,arguments)},iSw=function(){ys.apply(this,arguments)},GQL=function(){ys.apply(this,arguments)},gM7=function(){ys.apply(this,
arguments)},kQ9=function(){ys.apply(this,arguments)},DzJ=function(){ys.apply(this,arguments)},w9M=function(){ys.apply(this,arguments)},JvU=function(){ys.apply(this,arguments)},VOM=function(){ys.apply(this,arguments)},Cmg=function(){ys.apply(this,arguments)},aHe=function(){ys.apply(this,arguments)},NQw=function(){ys.apply(this,arguments)},mzL=function(){ys.apply(this,arguments)},yvN=function(){ys.apply(this,arguments)},ZSL=function(){ys.apply(this,arguments)},p97=function(){ys.apply(this,arguments)},
$zN=function(){ys.apply(this,arguments)},jj7=function(){ys.apply(this,arguments)},HSL=function(){ys.apply(this,arguments)},lHh=function(){ys.apply(this,arguments)},Pme=function(){ys.apply(this,arguments)},QjU=function(){ys.apply(this,arguments)},dzw=function(){ys.apply(this,arguments)},Uz7=function(){ys.apply(this,arguments)},EMe=function(){ys.apply(this,arguments)},X9e=function(){ys.apply(this,arguments)},KVM=function(){ys.apply(this,arguments)},YBg=function(){mw.apply(this,arguments)},nM9=function(){ys.apply(this,
arguments)},e$7=function(){ys.apply(this,arguments)},LIL=function(){ys.apply(this,arguments)},cxe=function(){ys.apply(this,arguments)},ITZ=function(){ys.apply(this,arguments)},BUM=function(){ys.apply(this,arguments)},x1e=function(){ys.apply(this,arguments)},o7h=function(){ys.apply(this,arguments)},SpM=function(){ys.apply(this,arguments)},rxN=function(){ys.apply(this,arguments)},h$N=function(){ys.apply(this,arguments)},R$L=function(){ys.apply(this,arguments)},uCN=function(){ys.apply(this,arguments)},
tyN=function(){ys.apply(this,arguments)},OMM=function(){ys.apply(this,arguments)},qpL=function(){ys.apply(this,arguments)},TUe=function(){ys.apply(this,arguments)},WIe=function(){ys.apply(this,arguments)},My7=function(){ys.apply(this,arguments)},z$N=function(){ys.apply(this,arguments)},sm7=function(){ys.apply(this,arguments)},v7e=function(){ys.apply(this,arguments)},fTZ=function(){ys.apply(this,arguments)},Axe=function(){ys.apply(this,arguments)},FIJ=function(){ys.apply(this,arguments)},bMM=function(){ys.apply(this,
arguments)},iM7=function(){ys.apply(this,arguments)},GTN=function(){ys.apply(this,arguments)},g77=function(){ys.apply(this,arguments)},kTL=function(){ys.apply(this,arguments)},D1Z=function(){ys.apply(this,arguments)},wkZ=function(){ys.apply(this,arguments)},JxL=function(){ys.apply(this,arguments)},Vye=function(e){e=e.key||e.id;
if(!e)throw Error("Entity key is missing");return e},CbZ=function(){if(Zq)return Zq();
var e={};Zq=g.PK("PersistentEntityStoreDb",{ib:(e.EntityStore={YV:1},e.EntityAssociationStore={YV:2},e),shared:!1,upgrade:function(L,c){c(1)&&g.GI(g.vK(L,"EntityStore",{keyPath:"key"}),"entityType","entityType");c(2)&&(L=g.vK(L,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.GI(L,"byParentEntityKey","parentEntityKey"),g.GI(L,"byChildEntityKey","childEntityKey"))},
version:3});return Zq()},aTN=function(e){return g.aM(CbZ(),e)},NUe=function(e){return g.aM((0,g.Mfg)(),e)},p9=function(e){this.token=e},$U=function(e,L){L=L===void 0?{}:L;
g.yu.call(this,g.zrh[e],Object.assign({},{name:"PESEncoderError",type:e},L));this.type=e;this.level="WARNING";Object.setPrototypeOf(this,$U.prototype)},m1e=function(e){return new $U("WRONG_DATA_TYPE",{Hb:e})},yxh=function(e){return e instanceof Error?new $U("UNKNOWN_ENCODE_ERROR",{originalMessage:e.message}):new $U("UNKNOWN_ENCODE_ERROR")},ZMM=function(e){return e instanceof Error?new $U("UNKNOWN_DECODE_ERROR",{originalMessage:e.message}):new $U("UNKNOWN_DECODE_ERROR")},pkh=function(e,L){e=e instanceof
$U?e:L(e);
g.A9(e);throw e;},$1L=function(){},jmh=function(e,L,c){try{return e.Z(L,c)}catch(I){pkh(I,yxh)}},HMZ=function(e){e=(new TextEncoder).encode(e).subarray(0,16);
var L=new Uint8Array(16);L.set(e);return L},j7=function(e){this.X=e},Pbe=function(e){var L=lTM[e];
if(L)return L;g.F7(new g.yu("Entity model not found.",{entityType:e}))},Qme=function(e,L){this.X=e;
this.K=L;this.Z={}},U1g=function(e,L){a:{e=d1N(e.K,L.version);
try{var c=e.K(L.data,L.key);break a}catch(I){pkh(I,ZMM)}c=void 0}return c},HV=function(e,L,c){return e.X.objectStore("EntityStore").get(L).then(function(I){if(I){if(c&&I.entityType!==c)throw Error("Incorrect entity type");
return U1g(e,I)}})},l9=function(e,L,c){return c?(c=c.map(function(I){return HV(e,I,L)}),g.qO.all(c)):e.X.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(L)).then(function(I){return I.map(function(B){return U1g(e,B)})})},Qs=function(e,L,c){var I=Vye(L),B=d1N(e.K,1),x=Object.assign({},L);
return e.X.objectStore("EntityStore").get(I).then(function(S){if(S){if(S.entityType!==c)throw Error("Incorrect entity type");x.entityMetadata||(S=U1g(e,S),x.entityMetadata=S.entityMetadata)}}).then(function(){var S={key:I,
entityType:c,data:jmh(B,x,I),version:1};return g.qO.all([g.F9(e.X.objectStore("EntityStore"),S),E7L(e,x,c)])}).then(function(){PV(e,I,c);
return I})},XkL=function(e,L,c){L=L.map(function(I){return Qs(e,I,c)});
return g.qO.all(L)},d6=function(e,L,c){if(c==null?0:c.X5){var I=new Set;
return KIJ(e,L,I).then(function(){for(var x=[],S=g.f(I),h=S.next();!h.done;h=S.next())x.push(d6(e,h.value));return g.qO.all(x).then(function(){})})}var B=g.QB(L).entityType;
return g.qO.all([e.X.objectStore("EntityStore").delete(L),Yp9(e,L)]).then(function(){PV(e,L,B)})},n7N=function(e,L){return g.wm(e.X.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(L)},function(c){return g.qO.all([c.delete(),
Yp9(e,c.cursor.primaryKey)]).then(function(){PV(e,c.cursor.primaryKey,L);return g.ki(c)})})},epU=function(e,L,c,I){var B=d1N(e.K,1);
return HV(e,L,I).then(function(x){if(x){x=g.ni(x,c);var S={key:L,entityType:I,data:jmh(B,x,L),version:1};return g.qO.all([g.F9(e.X.objectStore("EntityStore"),S),E7L(e,x,I)])}}).then(function(){PV(e,L,I);
return L})},PV=function(e,L,c){var I=e.Z[c];
I||(I=new Set,e.Z[c]=I);I.add(L)},LcZ=function(e,L,c){var I=Vye(L);
c=Pbe(c);if(!c)return g.qO.resolve([]);c=new c(L);e=e.X.objectStore("EntityAssociationStore");L=[];c=g.f(c.K());for(var B=c.next();!B.done;B=c.next())L.push(g.F9(e,{parentEntityKey:I,childEntityKey:B.value}));return g.qO.all(L).then(function(x){return x.map(function(S){return S[1]})})},Yp9=function(e,L){return e.X.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(L))},E7L=function(e,L,c){var I=Vye(L);
return Yp9(e,I).then(function(){return LcZ(e,L,c)})},KIJ=function(e,L,c){if(c.has(L))return g.qO.resolve(void 0);
c.add(L);return cie(e,L).then(function(I){return e.X.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(L)).then(function(){return I})}).then(function(I){var B=g.qO.resolve(void 0);
I=g.f(I);for(var x=I.next(),S={};!x.done;S={nt:void 0},x=I.next())S.nt=x.value,B=B.then(function(h){return function(){return KIJ(e,h.nt,c)}}(S));
return B}).then(function(){})},cie=function(e,L){var c=e.X.objectStore("EntityAssociationStore");
return c.index("byParentEntityKey").getAll(IDBKeyRange.only(L)).then(function(I){var B=[];I=g.f(I);for(var x=I.next();!x.done;x=I.next())x=x.value,B.push(c.index("byChildEntityKey").getAll(x.childEntityKey));return g.qO.all(B)}).then(function(I){var B=[];
I=g.f(I);for(var x=I.next();!x.done;x=I.next())x=x.value,x.length===1&&B.push(x[0].childEntityKey);return B})},U0=function(){},ISN=function(){this.X={};
this.X[0]=new U0;if(!g.uL("aes_pes_encoder_killswitch")){var e=this.X;try{var L=g.Z8();var c=HMZ(L);var I=new j7(new g.oz(c),new g.S3(c))}catch(B){throw e=B instanceof Error?new $U("KEY_CREATION_FAILED",{originalMessage:B.message}):new $U("KEY_CREATION_FAILED"),g.A9(e),e;}e[1]=I}},d1N=function(e,L){L=L===void 0?0:L;
e=e.X[L];if(!e)throw L=new $U("INVALID_ENCODER_VERSION",{Hb:L}),g.A9(L),L;return e},E0=function(e,L){g.p.call(this);
this.token=e;this.X=L;this.observers=[];e=new g.LZ.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Z8());e.onmessage=this.K.bind(this);this.channel=e},XE=function(e,L,c){var I,B,x,S;
return g.Z(function(h){if(h.K==1)return g.a(h,aTN(e.token),2);if(h.K!=3)return I=h.X,g.a(h,g.Ag(I,["EntityStore","EntityAssociationStore"],L,function(R){B=new Qme(R,e.X);return c(B)}),3);
x=h.X;B&&(S=B.Z,Object.keys(S).length>0&&(e.channel.postMessage(S),BTZ(e,S)));return h.return(x)})},K9=function(e,L,c){return XE(e,{mode:"readwrite",
tK:!0},function(I){return Qs(I,L,c)})},xqw=function(e,L){return XE(e,{mode:"readwrite",
tK:!0},function(c){return XkL(c,L,"offlineOrchestrationActionWrapperEntity")})},oAZ=function(e,L){return XE(e,{mode:"readwrite",
tK:!0},function(c){return d6(c,L)})},Sae=function(e){return XE(e,{mode:"readwrite",
tK:!0},function(L){return n7N(L,"videoPlaybackPositionEntity")})},YU=function(e,L,c){return XE(e,{mode:"readonly",
tK:!0},function(I){return HV(I,L,c)})},n9=function(e,L,c){return XE(e,{mode:"readonly",
tK:!0},function(I){return l9(I,L,c)})},BTZ=function(e,L){e=g.f(e.observers);
for(var c=e.next();!c.done;c=e.next())c=c.value,c(L)},riL=function(){var e,L,c;
return g.Z(function(I){if(I.K==1)return g.bn(I,2),g.a(I,g.HK(),4);if(I.K!=2){e=I.X;if(!e||!g.pv()||typeof g.LZ.BroadcastChannel==="undefined")return I.return();L=new ISN;return I.return(new E0(e,L))}c=g.wc(I);c instanceof Error&&g.A9(c);return I.return()})},eV=function(){hpN||(hpN=riL());
return hpN},Rpe=function(e){var L;
e=(L=e.options)==null?void 0:L.persistenceOption;return e==="ENTITY_PERSISTENCE_OPTION_PERSIST"||e==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},u2U=function(e){var L;
return g.Z(function(c){return c.K==1?g.a(c,eV(),2):(L=c.X)?g.a(c,XE(L,"readwrite",function(I){for(var B={},x=g.f(e),S=x.next(),h={};!S.done;h={gp:void 0,TK:void 0},S=x.next())h.gp=S.value,h.gp.entityKey&&Rpe(h.gp)&&(h.TK=g.SR(h.gp.payload),S=void 0,h.gp.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(S=function(R){return function(){return Qs(I,R.gp.payload[R.TK],R.TK)}}(h)),h.gp.type==="ENTITY_MUTATION_TYPE_DELETE"&&(S=function(R){return function(){return d6(I,R.gp.entityKey)}}(h)),h.gp.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(S=function(R){return function(){return epU(I,R.gp.entityKey,R.gp.payload[R.TK],R.TK)}}(h)),S&&(B[h.gp.entityKey]=B[h.gp.entityKey]?B[h.gp.entityKey].then(S):S()));
return g.qO.all(Object.values(B))}),0):c.return()})},tAL=function(e){var L;
return g.Z(function(c){if(c.K==1){L=e.mutations;if(!L||L.length<=0)return c.return();if(g.vN){var I={type:"ENTITY_LOADED"};L!==void 0&&(I.payload=L);g.vN.dispatch(I)}return g.a(c,u2U(L),2)}L.length=0;g.AJ(c)})},OcL=function(e){return e!==void 0},qae=function(e){var L=g.Ej();
L=Object.assign({},L);e=Object.assign({},e);for(var c in L)e[c]?(L[c]!==4&&(L[c]=e[c]),delete e[c]):L[c]!==2&&(L[c]=4);Object.assign(L,e);g.y8$(L);JSON.stringify(L);return L},TTM=function(e){var L,c;
return g.Z(function(I){if(I.K==1)return g.a(I,g.HK(),2);if(I.K!=3)return(L=I.X)?g.a(I,g.YY(L),3):I.return();c=I.X;return I.return(g.Ag(c,["index","media","captions"],{mode:"readwrite",tK:!0},function(B){var x=IDBKeyRange.bound(e+"|",e+"~");B=[B.objectStore("index").delete(x),B.objectStore("media").delete(x),B.objectStore("captions").delete(x)];return g.qO.all(B).then(function(){})}))})},WcM=function(){var e,L;
return g.Z(function(c){if(c.K==1)return g.a(c,g.HK(),2);if(c.K!=3){e=c.X;if(!e)throw g.tg("rvdfd");return g.a(c,g.YY(e),3)}L=c.X;return c.return(g.Ag(L,["index","media"],{mode:"readwrite",tK:!0},function(I){var B={};return g.gm(I.objectStore("index"),{},function(x){var S=x.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),h=g.qO.resolve(void 0);if(S){var R=S[1];S=S[2];B[R]=B[R]||{};var u;B[R][S]=g.HPc((u=x.getValue())==null?void 0:u.fmts)}else h=x.delete().then(function(){});
return g.qO.all([g.ki(x),h]).then(function(t){return g.f(t).next().value})}).then(function(){for(var x={},S=g.f(Object.keys(B)),h=S.next();!h.done;h=S.next()){h=h.value;
var R=B[h].v;x[h]=B[h].a&&R?1:2}var u=qae(x);return g.kf$(I.objectStore("media"),{},function(t){var O=t.cursor.key.match(g.dbf);O&&x[O[1]]||I.objectStore("media").delete(t.cursor.key);return g.sbc(t)}).then(function(){return u})})}))})},MAe=function(e,L){var c,I;
return g.Z(function(B){if(B.K==1)return g.a(B,g.HK(),2);if(B.K!=3){c=B.X;if(!c)throw g.tg("wct");return g.a(B,g.YY(c),3)}I=B.X;return g.a(B,g.Ag(I,["captions"],{mode:"readwrite",tK:!0},function(x){var S=[];x=x.objectStore("captions");for(var h=0;h<L.length;h++){var R=g.F9(x,L[h],e+"|"+L[h].metadata.vss_id);S.push(R)}return g.qO.all(S)}),0)})},zpw=function(e){var L,c,I;
return g.Z(function(B){if(B.K==1)return L=IDBKeyRange.bound(e+"|",e+"~"),g.a(B,g.HK(),2);if(B.K!=3){c=B.X;if(!c)throw g.tg("gactfv");return g.a(B,g.YY(c),3)}I=B.X;return B.return(I.getAll("captions",L))})},s$N=function(e){return g.Z(function(L){g.K8(e,0);
return L.return(TTM(e))})},vAM=function(e){return{context:g.l1(),
videoIds:e}},fSJ=function(e){return{context:g.l1(),
playlistIds:e}},AiM=function(e){return{context:g.l1(),
offlinePlaylistSyncChecks:e}},FcL=function(){this.X=new Map},icM=function(){bcN||(bcN=new FcL);
return bcN},G4N=function(e,L){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:e},metadata:L,statusCode:void 0,csn:void 0,can:void 0}},gAg=function(e,L,c){if(!c){var I=I===void 0?!1:I;
c=e.X.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!c||I)c=g.Rp(16),e.X.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",c)}e={flowNonce:c,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:L.eventType};L.metadata&&(e.flowMetadata=L.metadata);L.statusCode!==void 0&&(e.flowEventStatus=L.statusCode);L.csn&&(e.csn=L.csn);L.can&&(e.can=L.can);g.et("flowEvent",e,void 0)},k4N=function(e){var L,c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ,Mg,QM,Is,D,Zt;
return g.Z(function(CZ){if(CZ.K==1)return g.a(CZ,XE(e,{mode:"readonly",tK:!0},function(IH){return l9(IH,"playbackData").then(function(wM){var F=wM.map(function(je){return je.transfer}).filter(function(je){return!!je}),L6=wM.map(function(je){return je.offlineVideoPolicy}).filter(function(je){return!!je}),Qc=wM.filter(function(je){return!!je.key}).map(function(je){return g.dL(g.QB(je.key).entityId,"downloadStatusEntity")});
F=l9(IH,"transfer",F);L6=l9(IH,"offlineVideoPolicy",L6);Qc=l9(IH,"downloadStatusEntity",Qc);var S5=F.then(function(je){je=je.reduce(function(dc,ee){(ee==null?0:ee.offlineVideoStreams)&&dc.push.apply(dc,g.V(ee.offlineVideoStreams));return dc},[]).filter(function(dc){return!!dc});
return l9(IH,"offlineVideoStreams",je)});
return g.qO.all([F,L6,S5,Qc]).then(function(je){var dc=g.f(je);je=dc.next().value;var ee=dc.next().value;var ne=dc.next().value;dc=dc.next().value;return[wM,je,ee,ne,dc]})})}),2);
if(CZ.K!=3)return L=CZ.X,g.a(CZ,XE(e,{mode:"readonly",tK:!0},function(IH){return l9(IH,"mainDownloadsListEntity").then(function(wM){var F,L6;return(L6=(F=wM[0])==null?void 0:F.downloads)!=null?L6:[]})}),3);
c=CZ.X;I=g.f(L);B=I.next().value;x=I.next().value;S=I.next().value;h=I.next().value;R=I.next().value;u=B;t=x;O=S;q=h;T=R;W={};A={};b={};J={};w={};C=[];y=g.f(t);for(P=y.next();!P.done;P=y.next())(ev=P.value)&&(W[ev.key]=ev);X=g.f(O);for(oH=X.next();!oH.done;oH=X.next())(rc=oH.value)&&(A[rc.key]=rc);Sv=g.f(T);for(tJ=Sv.next();!tJ.done;tJ=Sv.next())(cM=tJ.value)&&(b[cM.key]=cM);JJ=g.f(q);for(yr=JJ.next();!yr.done;yr=JJ.next())(cU=yr.value)&&(J[cU.key]=cU);$N=g.f(c);for(fZ=$N.next();!fZ.done;fZ=$N.next())$n=
fZ.value,nZ=void 0,w[(nZ=$n.videoItem)!=null?nZ:""]=!0,$n.videoItem&&(QM=Mg=void 0,Is=(QM=(Mg=g.QB($n.videoItem))==null?void 0:Mg.entityId)!=null?QM:"",C.push({externalVideoId:Is}));D=u.filter(function(IH){if(!IH||!IH.key||!IH.offlineVideoPolicy)return!1;IH=g.QB(IH.key).entityId;IH=g.dL(IH,"downloadStatusEntity");var wM;return!(IH&&((wM=b[IH])==null?void 0:wM.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Zt=D.map(function(IH){var wM=W[IH.transfer],F=[];if(wM==null?0:wM.offlineVideoStreams)for(var L6=g.f(wM.offlineVideoStreams),Qc=L6.next();!Qc.done;Qc=L6.next())(Qc=J[Qc.value])&&F.push(Qc);L6=A[IH.offlineVideoPolicy];Qc=w;var S5=IH==null?void 0:IH.playerResponseTimestamp,je=g.QB(L6.key).entityId;IH=g.dL(je,"mainVideoEntity");if(L6.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var dc="OFFLINE_VIDEO_STATE_DISABLED";L6.expirationTimestamp&&Number(L6.expirationTimestamp)<Date.now()/1E3&&(dc="OFFLINE_VIDEO_STATE_EXPIRED")}else if(L6.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")dc="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(wM==null?void 0:wM.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":dc="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":dc="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":dc="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":dc="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":dc="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":dc="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:dc="OFFLINE_VIDEO_STATE_UNKNOWN"}if(dc==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(wM==null?void 0:wM.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":dc="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":dc="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":dc=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}je={id:je,videoState:dc};if(wM==null?0:wM.cotn)je.cotn=wM.cotn;if(wM==null?0:wM.maximumDownloadQuality)je.selectedVideoQuality=wM==null?void 0:wM.maximumDownloadQuality;if(wM==null?0:wM.lastProgressTimeMs)je.lastProgressTimeMs=wM.lastProgressTimeMs;S5&&(je.playerResponseSavedTimeMs=String(Number(S5)*1E3));wM=String;S5=0;F=g.f(F);for(dc=F.next();!dc.done;dc=F.next())if(dc=dc.value,dc.streamsProgress){dc=g.f(dc.streamsProgress);for(var ee=dc.next();!ee.done;ee=dc.next()){var ne=
void 0;S5+=Number((ne=ee.value.numBytesDownloaded)!=null?ne:0)}}je.downloadedBytes=wM(S5);je.selectedOfflineMode=Qc[IH]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";L6.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(je.offlinePlaybackDisabledReason=L6.offlinePlaybackDisabledReason);return je});
return CZ.return({offlineVideos:Zt,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:C}}})})},DqL=function(){this.locks=navigator.locks},woM=function(){try{var e=g.BU("ytglobal.locks_");
if(e)return e;var L;if(L=navigator){var c=navigator;L="locks"in c&&!!c.locks}if(L)return g.LZ.localStorage&&g.LZ.localStorage.getItem("noop"),e=new DqL,g.IL("ytglobal.locks_",e),e}catch(I){}},Ld=function(){},JiU=function(){},VAN=function(e){if(e.includes(":"))throw Error("Invalid user cache name: "+e);
return e+":"+g.Z8("CacheStorage get")},Cqh=function(){return g.Z(function(e){if(cg!==void 0)return e.return(cg);
cg=new Promise(function(L){var c;return g.Z(function(I){switch(I.K){case 1:return g.bn(I,2),g.a(I,I4.open("test-only"),4);case 4:return g.a(I,I4.delete("test-only"),5);case 5:g.DR(I,3);break;case 2:if(c=g.wc(I),c instanceof Error&&c.name==="SecurityError")return L(!1),I.return();case 3:L("caches"in window),g.AJ(I)}})});
return e.return(cg)})},NTZ=function(){return g.Z(function(e){if(e.K==1)return g.a(e,Cqh(),2);
if(!e.X)return e.return(void 0);aSe||(aSe=new JiU);return e.return(aSe)})},Bg=function(e,L,c){g.F7(new g.yu("Woffle: "+e,c?{cotn:c}:""));
L instanceof Error&&g.F7(L)},mqN=function(e){var L;
return g.Z(function(c){if(c.K==1)return g.a(c,k4N(e),2);L=c.X;g.et("offlineStateSnapshot",L);g.AJ(c)})},xS=function(e){g.p.call(this);
var L=this;this.api=e;this.kx={W5Y:function(){return L.X},
fle:function(){return L.K}};
typeof g.LZ.BroadcastChannel!=="undefined"&&(this.X=new g.LZ.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Z8()),this.X.onmessage=this.Z.bind(this),this.K=new g.LZ.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Z8()),this.K.onmessage=this.G.bind(this))},o4=function(e,L){e.api.fS("onOfflineOperationFailure",L);
var c;(c=e.X)==null||c.postMessage(L)},yiZ=function(e,L,c){var I=this;
this.J=e;this.D=L;this.visibility=c;this.B=this.T=this.j=this.Z=this.X=!1;this.G=new g.j9(function(){I.tf()});
this.kx={JF:function(){return I.K},
tf:function(){I.tf()},
x2W:function(){return I.G}};
this.visibility.subscribe("visibilitystatechange",function(){I.dZ()})},ZcM=function(e){if(!e.Z&&!e.X){var L=woM();
if(L){e.Z=!0;var c=g.Z8("OfflineLockManager");L.request("woffle_orchestration_leader:"+c,{},function(){var I,B;return g.Z(function(x){switch(x.K){case 1:return g.bn(x,2),e.K=new g.rk,e.X=!0,e.Z=!1,g.a(x,e.J(),4);case 4:return g.a(x,e.K.promise,5);case 5:g.DR(x,0);break;case 2:I=g.wc(x),e.tf(),I instanceof Error&&(B=I,B.args=[{name:"WoLockManagerError",ES:I.name}],g.A9(B)),g.AJ(x)}})})}}},pog=function(e){e.X&&(e.B=!0,SV(e))},$qe=function(e,L){e.X&&(e.j=L,SV(e))},j$7=function(e,L){e.X&&(e.T=L,SV(e))},
SV=function(e){e.T&&e.j&&e.B&&e.visibility.isBackground()?g.HT(e.G,6E4):e.G.stop()},rn=function(e){var L;
e.offlineDeleteReason=(L=e.offlineDeleteReason)!=null?L:"OFFLINE_DELETE_REASON_UNKNOWN";var c;e.offlineModeType=(c=e.offlineModeType)!=null?c:"OFFLINE_NOW";g.et("offlineDeleteEvent",e)},hs=function(e,L){var c=L.videoId;
var I=L.zc;L=L.offlineModeType;e.encryptedVideoId=c;e.cotn=I==null?void 0:I.cotn;e.offlineabilityFormatType=I==null?void 0:I.maximumDownloadQuality;var B;e.isRefresh=(B=I==null?void 0:I.isRefresh)!=null?B:!1;var x;e.softErrorCount=(x=I==null?void 0:I.transferRetryCount)!=null?x:0;e.offlineModeType=L!=null?L:"OFFLINE_NOW";(e.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&e.statusType==="UNKNOWN_STATUS_TYPE"||!e.transferStatusType&&!e.statusType)&&g.F7(Error("Woffle unknown transfer status"));
g.et("offlineTransferStatusChanged",e)},HcZ=function(e){hs({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},e)},lSw=function(e,L,c,I){I={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!I};L&&c&&(L=Math.floor(L/1024).toFixed(),c=Math.floor(c/1024).toFixed(),I.alreadyDownloadedKbytes=L,I.totalFetchedKbytes=L,I.totalContentKbytes=c);hs(I,e)},Pqh=function(e){hs({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},e)},Q$N=function(e){hs({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},e)},dqZ=function(e){switch(e){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
R4=function(e){var L,c,I;
return((I=(L=e.actionMetadata)==null?void 0:(c=L.retryScheduleIntervalsInSeconds)==null?void 0:c.length)!=null?I:0)>0},u4=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!e.entityKey},ts=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!e.entityKey},OM=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!e.entityKey},Uqw=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!e.entityKey},
qH=function(e,L,c,I,B){B=B===void 0?!1:B;
var x,S,h,R,u,t;return g.Z(function(O){if(O.K==1)return x=g.dL(e,L),S=g.dL(e,"downloadStatusEntity"),g.a(O,XE(c,{mode:"readonly",tK:!0},function(q){return g.qO.all([HV(q,x,L),HV(q,S,"downloadStatusEntity")])}),2);
h=O.X;R=h.length?h[0]:void 0;if(!R)return O.Iq(0);u=EAL;if(t=h.length>1?h[1]:void 0){if(t.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!B)return O.return();t.downloadState=I}else t={key:S,downloadState:I};g.kg(R,u,t);return g.a(O,XE(c,{mode:"readwrite",tK:!0},function(q){return g.qO.all([Qs(q,R,L),Qs(q,t,"downloadStatusEntity")])}),0)})},Tt=function(e,L){return e.actionType===L.actionType&&e.entityKey===L.entityKey},Wg=function(e,L){if(e&&e.transferState!=="TRANSFER_STATE_COMPLETE"&&e.transferState!==
"TRANSFER_STATE_FAILED"){var c=g.QB(e.key).entityId;
hs({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:c,zc:e,offlineModeType:L})}},MH=function(e){if(!e||!e.thumbnails)return[];
var L=[];e=g.f(e.thumbnails);for(var c=e.next();!c.done;c=e.next())c=c.value,c.url&&L.push(c.url);return L},XoL=function(e,L,c){c=c===void 0?[]:c;
var I,B,x,S,h,R,u,t,O,q,T,W,A;return g.Z(function(b){if(b.K==1)return c.length?g.a(b,n9(e,L),2):b.return([]);I=b.X;B=new Set;x=g.f(I);for(S=x.next();!S.done;S=x.next())if(h=S.value,R=h.id||h.key)u=g.QB(R).entityId,B.add(u);t=[];O=g.f(c);for(q=O.next();!q.done;q=O.next())T=q.value,W=T.offlineVideoData,A=void 0,((A=W)==null?0:A.videoId)&&!B.has(W.videoId)&&t.push(T);return b.return(t)})},Kch=function(e,L,c){return new g.RI(e,{cotn:L,
raw_player_response:c,download_media:!0,start:Infinity,disable_watch_next:!0})},Yae=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},zt=function(e,L,c,I,B,x,S,h,R,u,t){this.entityType=e;
this.actionId=L;this.action=c;this.parentActionId=I;this.rootActionId=B===void 0?L:B;this.childActionIds=x;this.prereqActionId=S;this.postreqActionIds=h;this.hasChildActionFailed=u;this.retryScheduleIndex=0;this.X=t||Date.now();this.retryScheduleIndex=R||0},sM=function(e){if(!e.key)throw Error("Entity key is required.");
if(!e.actionProto)throw Error("OfflineOrchestrationAction is required.");var L=g.QB(e.key),c=g.QB(e.actionProto.entityKey);return new zt(c.entityType,L.entityId,e.actionProto,e.parentActionId,e.rootActionId,e.childActionIds,e.prereqActionId,e.postreqActionIds,e.retryScheduleIndex,e.hasChildActionFailed,Number(e.enqueueTimeSec)*1E3)},vg=function(e){return{key:g.dL(e.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:e.action,parentActionId:e.parentActionId,rootActionId:e.rootActionId,childActionIds:e.childActionIds,prereqActionId:e.prereqActionId,postreqActionIds:e.postreqActionIds,retryScheduleIndex:e.retryScheduleIndex,hasChildActionFailed:e.hasChildActionFailed,enqueueTimeSec:(e.X/1E3).toFixed()}},nA7=function(){var e;
return g.Z(function(L){return L.K==1?g.a(L,NTZ(),2):(e=L.X)?L.return(e.delete("yt-player-local-img")):L.return(!0)})},fd=function(e){var L,c;
return g.Z(function(I){if(I.K==1)return g.a(I,NTZ(),2);if(I.K!=3){L=I.X;if(!L)throw Error("Cache API not supported");return e.length?g.a(I,L.open("yt-player-local-img"),3):I.return()}c=I.X;return g.a(I,Promise.all(e.map(function(B){return c.delete(B)})),0)})},As=function(e){var L,c;
return g.Z(function(I){if(I.K==1)return g.a(I,NTZ(),2);if(I.K!=3){L=I.X;if(!L)throw Error("Cache API not supported");return e.length?g.a(I,L.open("yt-player-local-img"),3):I.return()}c=I.X;return g.a(I,c.addAll(e),0)})},Ff=function(e,L,c,I,B){var x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ;
return g.Z(function(Mg){switch(Mg.K){case 1:return x=g.dL(e,"mainVideoEntity"),S=g.dL(e,"ytMainChannelEntity"),h=g.dL(e,"transfer"),R=g.dL(e,"videoDownloadContextEntity"),g.a(Mg,XE(L,{mode:"readonly",tK:!0},function(QM){return g.qO.all([HV(QM,x,"mainVideoEntity"),HV(QM,S,"ytMainChannelEntity"),HV(QM,h,"transfer"),HV(QM,R,"videoDownloadContextEntity"),l9(QM,"ytMainChannelEntity"),l9(QM,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:u=Mg.X;t=g.f(u);O=t.next().value;q=t.next().value;T=t.next().value;W=t.next().value;A=t.next().value;b=t.next().value;J=O;w=q;C=T;y=W;P=A;ev=b;if(!J&&!w){Mg.Iq(3);break}X=J?MH(J.thumbnail):[];if(!w){oH=[];Mg.Iq(4);break}return g.a(Mg,eLh(w,P),5);case 5:oH=Mg.X;case 4:return rc=oH,g.a(Mg,fd(X.concat(rc)),3);case 3:Sv=[];tJ=g.dL(e,"downloadStatusEntity");cM=g.f(ev);for(JJ=cM.next();!JJ.done;JJ=cM.next())yr=JJ.value,cU=g.QB(yr.key).entityId,$N=sM(yr),fZ=g.QB($N.action.entityKey).entityId,cU!==
e&&fZ!==e||Tt(c,yr.actionProto)||Sv.push(yr.key);return g.a(Mg,XE(L,{mode:"readwrite",tK:!0},function(QM){var Is=Sv.map(function(D){return d6(QM,D)});
Is.push(d6(QM,x,{X5:!0}));Is.push(d6(QM,tJ,{X5:!0}));return g.qO.all(Is)}),7);
case 7:nZ=($n=y)==null?void 0:$n.offlineModeType,B&&(rn(B),B.offlineModeType&&(nZ=B.offlineModeType)),Wg(C,nZ),o4(I,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.AJ(Mg)}})},IXJ=function(e,L,c,I){var B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ,Mg,QM,Is,D,Zt,CZ,IH,wM,F,L6,Qc,S5,je,dc,ee,ne,pe,G;
return g.Z(function(v){switch(v.K){case 1:return B=g.dL(e,"mainPlaylistEntity"),x=g.dL(e,"ytMainChannelEntity"),g.a(v,XE(L,{mode:"readonly",tK:!0},function(k){return g.qO.all([HV(k,B,"mainPlaylistEntity"),HV(k,x,"ytMainChannelEntity"),l9(k,"mainPlaylistEntity"),l9(k,"mainDownloadsListEntity"),l9(k,"ytMainChannelEntity"),l9(k,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=v.X;h=g.f(S);R=h.next().value;u=h.next().value;t=h.next().value;O=h.next().value;q=h.next().value;T=h.next().value;W=R;A=u;b=t;J=O;w=q;C=T;if(!W&&!A){v.Iq(3);break}y=W?La7(W):[];if(!A){P=[];v.Iq(4);break}return g.a(v,eLh(A,w),5);case 5:P=v.X;case 4:return ev=P,g.a(v,fd(y.concat(ev)),3);case 3:X=[];oH=new Map;if(!W){v.Iq(7);break}return g.a(v,cUL(W,b,J),8);case 8:X=v.X;rc=g.f(X);for(Sv=rc.next();!Sv.done;Sv=rc.next())tJ=Sv.value,oH.set(tJ,{videoId:tJ,playlistId:e,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.a(v,XE(L,{mode:"readonly",tK:!0},function(k){return g.qO.all([l9(k,"transfer"),l9(k,"videoDownloadContextEntity")])}),9);
case 9:cM=v.X;JJ=g.f(cM);yr=JJ.next().value;cU=JJ.next().value;$N=yr;fZ=cU;$n=g.f($N);for(nZ=$n.next();!nZ.done;nZ=$n.next())Mg=nZ.value,QM=g.QB(Mg.key).entityId,(Is=oH.get(QM))&&Mg&&(Is.cotn=Mg.cotn);D=g.f(fZ);for(Zt=D.next();!Zt.done;Zt=D.next())CZ=Zt.value,IH=g.QB(CZ.key).entityId,(wM=oH.get(IH))&&CZ&&(wM.offlineModeType=CZ.offlineModeType);case 7:F=[];L6=g.f(C);for(Qc=L6.next();!Qc.done;Qc=L6.next())S5=Qc.value,je=g.QB(S5.key).entityId,dc=sM(S5),je!==e&&dc.rootActionId!==e||Tt(c,S5.actionProto)||
F.push(S5.key);ee=g.dL(e,"mainPlaylistEntity");return g.a(v,XE(L,{mode:"readwrite",tK:!0},function(k){var N=F.map(function(H){return d6(k,H)});
N.push(d6(k,ee,{X5:!0}));return g.qO.all(N)}),10);
case 10:if(!W){v.Iq(0);break}X.reverse();if(!X){v.Iq(0);break}ne=g.f(X);pe=ne.next();case 13:if(pe.done){v.Iq(0);break}G=pe.value;return g.a(v,Ff(G,L,c,I,oH.get(G)),14);case 14:pe=ne.next(),v.Iq(13)}})},xkZ=function(e,L,c,I){var B,x,S,h,R,u,t,O,q;
return g.Z(function(T){if(T.K==1)return B=g.dL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),x=new Map,g.a(T,XE(e,{mode:"readwrite",tK:!0},function(W){var A=l9(W,"transfer"),b=l9(W,"offlineOrchestrationActionWrapperEntity"),J=l9(W,"videoDownloadContextEntity"),w=HV(W,B,"mainDownloadsListEntity");return g.qO.all([A,b,J,w]).then(function(C){C=g.f(C);var y=C.next().value;var P=C.next().value;var ev=C.next().value;var X=C.next().value;C=Bk9.map(function(rc){return n7N(W,rc)});
P=g.f(P);for(var oH=P.next();!oH.done;oH=P.next())oH=oH.value,Tt(L,oH.actionProto)||C.push(d6(W,oH.key,{X5:!0}));X&&(X.downloads=[],C.push(Qs(W,X,"mainDownloadsListEntity")));if(ev)for(ev=g.f(ev),X=ev.next();!X.done;X=ev.next())X=X.value,P=g.QB(X.key).entityId,P=g.dL(P,"transfer"),x.set(P,X.offlineModeType);return g.qO.all(C).then(function(){return y})})}),2);
S=T.X;h=g.f(S);for(R=h.next();!R.done;R=h.next())u=R.value,Wg(u,x.get(u.key)),t=g.QB(u.key).entityId,O={videoId:t,offlineDeleteReason:I,cotn:u.cotn,offlineModeType:x.get(u.key)},rn(O),q=g.dL(t,"mainVideoEntity"),o4(c,{entityKey:q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.a(T,nA7(),0)})},La7=function(e,L){var c=[];
if(e.thumbnailStyleData){e=g.f(e.thumbnailStyleData);for(var I=e.next();!I.done;I=e.next()){var B=void 0,x=void 0,S=void 0;c=c.concat(MH((B=I.value)==null?void 0:(x=B.value)==null?void 0:(S=x.collageThumbnail)==null?void 0:S.coverThumbnail))}}L=MH(L);return c.concat(L)},cUL=function(e,L,c){var I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc;
return g.Z(function(Sv){I=[];B=new Set;if(c.length)for(x=g.f(c),S=x.next();!S.done;S=x.next())if(h=S.value,R=void 0,(R=h.downloads)==null?0:R.length)for(u=g.f(h.downloads),t=u.next();!t.done;t=u.next())O=t.value,O.videoItem&&(q=g.QB(O.videoItem).entityId,B.add(q));if(e.videos){T=g.f(e.videos);for(W=T.next();!W.done;W=T.next())A=W.value,b=JSON.parse(g.QB(A).entityId),b.videoId&&!B.has(b.videoId)&&I.push(b.videoId);J=g.f(L);for(w=J.next();!w.done;w=J.next())if(C=w.value,C.key!==e.key&&(y=C.videos))for(P=
g.f(y),ev=P.next();!ev.done;ev=P.next())X=ev.value,oH=JSON.parse(g.QB(X).entityId),oH.videoId&&(rc=I.indexOf(oH.videoId),rc!==-1&&I.splice(rc,1))}return Sv.return(I)})},eLh=function(e,L){var c,I,B,x,S,h,R,u;
return g.Z(function(t){c=MH(e.avatar);I=g.f(L);for(B=I.next();!B.done;B=I.next())if(x=B.value,x.id!==e.id)for(S=g.f(MH(x.avatar)),h=S.next();!h.done;h=S.next())R=h.value,u=c.indexOf(R),u!==-1&&c.splice(u,1);return t.return(c)})},odU=function(e){var L;
return g.Z(function(c){L=g.Q(e.frameworkUpdates,b4);return e.frameworkUpdates&&L?g.a(c,tAL(L),0):c.return()})},rU7=function(e){var L;
if((L=e.onResponseReceivedActions)!=null&&L.length){var c;e=(c=g.Q(g.Q(e.onResponseReceivedActions[0],SAJ),g.TzM))==null?void 0:c.actions;if(e!=null&&e.length)return e}},hLU=function(e){var L,c,I;
return g.Z(function(B){if(B.K==1)return e?g.a(B,YU(e,g.Hj,"mainDownloadsListEntity"),2):B.return([]);L=B.X;return((c=L)==null?0:(I=c.downloads)==null?0:I.length)?B.return(L.downloads.map(function(x){var S;return(S=x.videoItem)!=null?S:""})):B.return([])})},u_Z=function(e,L){var c;
return g.Z(function(I){return I.K==1?g.a(I,RLZ(e,L),2):(c=I.X)?g.a(I,XE(e,{mode:"readwrite",tK:!0},function(B){var x=[Qs(B,c.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];c.mainDownloadsListEntity&&x.push(Qs(B,c.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.qO.all(x)}),0):I.Iq(0)})},RLZ=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C;
return g.Z(function(y){if(y.K==1)return c=g.dL("main_downloads_library_id","mainDownloadsLibraryEntity"),I=g.dL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.a(y,XE(e,{mode:"readonly",tK:!0},function(P){return g.qO.all([HV(P,c,"mainDownloadsLibraryEntity"),HV(P,I,"mainDownloadsListEntity")])}),2);
B=y.X;x=g.f(B);S=x.next().value;h=x.next().value;R=S;u=h;R||(R={id:c});t=g.f(L);for(O=t.next();!O.done;O=t.next())if(q=O.value,q===g.Hj){if(R.smartDownloadsList)return y.return();R.smartDownloadsList=q}else if(T=g.QB(q).entityType,W={},T==="mainPlaylistEntity"?W.playlistItem=q:T==="mainVideoEntity"&&(W.videoItem=q),!g.qQ(W)){A=void 0;if((A=u)==null?0:A.downloads){b=!1;J=g.f(u.downloads);for(w=J.next();!w.done;w=J.next())if(C=w.value,C.playlistItem===q||C.videoItem===q){b=!0;break}b||u.downloads.push(W)}else u=
{id:I,downloads:[W]};R.downloadsList=I}return y.return({mainDownloadsLibraryEntity:R,mainDownloadsListEntity:u})})},t1e=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b;
return g.Z(function(J){if(J.K==1)return c=g.dL("main_downloads_library_id","mainDownloadsLibraryEntity"),I=g.dL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.a(J,XE(e,{mode:"readonly",tK:!0},function(w){return g.qO.all([HV(w,c,"mainDownloadsLibraryEntity"),HV(w,I,"mainDownloadsListEntity"),HV(w,g.Hj,"mainDownloadsListEntity")])}),2);
B=J.X;x=g.f(B);S=x.next().value;h=x.next().value;R=x.next().value;u=S;t=h;O=R;if(!u)return J.Iq(0);if(L===g.Hj&&((q=O)==null?0:q.downloads))O.downloads=[];else if((T=t)==null?0:T.downloads)for(W=g.QB(L).entityType,A=0;A<t.downloads.length;A++)if(b=t.downloads[A],W==="mainVideoEntity"&&b.videoItem===L){t.downloads.splice(A,1);break}else if(W==="mainPlaylistEntity"&&b.playlistItem===L){t.downloads.splice(A,1);break}return g.a(J,XE(e,{mode:"readwrite",tK:!0},function(w){var C=[Qs(w,u,"mainDownloadsLibraryEntity")];
t&&C.push(Qs(w,t,"mainDownloadsListEntity"));O&&C.push(Qs(w,O,"mainDownloadsListEntity"));return g.qO.all(C)}),0)})},i4=function(e,L){var c,I,B,x,S,h,R,u,t,O,q;
return g.Z(function(T){if(T.K==1)return c=g.dL(L,"transfer"),I=g.dL(L,"videoDownloadContextEntity"),g.a(T,XE(e,{mode:"readonly",tK:!0},function(W){return g.qO.all([HV(W,c,"transfer"),HV(W,I,"videoDownloadContextEntity")])}),2);
B=T.X;x=g.f(B);S=x.next().value;h=x.next().value;R=S;u=h;q={videoId:L,cotn:(t=R)==null?void 0:t.cotn,offlineModeType:(O=u)==null?void 0:O.offlineModeType};return T.return(q)})},Gt=function(e,L,c,I,B){var x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH;
return g.Z(function(rc){switch(rc.K){case 1:return x=g.dL(e,"musicTrack"),S=g.dL(e,"transfer"),g.a(rc,XE(L,{mode:"readonly",tK:!0},function(Sv){return g.qO.all([HV(Sv,x,"musicTrack"),HV(Sv,S,"transfer"),l9(Sv,"musicTrack"),l9(Sv,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=rc.X;R=g.f(h);u=R.next().value;t=R.next().value;O=R.next().value;q=R.next().value;T=u;W=t;A=O;b=q;if(!T){rc.Iq(3);break}return g.a(rc,OaZ(T,A),4);case 4:return J=rc.X,g.a(rc,fd(J),3);case 3:w=[];C=g.f(b);for(y=C.next();!y.done;y=C.next())P=y.value,ev=g.QB(P.key).entityId,X=sM(P),oH=g.QB(X.action.entityKey).entityId,ev!==e&&oH!==e||Tt(c,P.actionProto)||w.push(P.key);return g.a(rc,XE(L,{mode:"readwrite",tK:!0},function(Sv){var tJ=w.map(function(cM){return d6(Sv,cM)});
tJ.push(d6(Sv,x,{X5:!0}));return g.qO.all(tJ)}),6);
case 6:Wg(W),B&&rn(B),o4(I,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.AJ(rc)}})},gn=function(e,L,c,I,B){var x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ,Mg,QM,Is,D,Zt;
return g.Z(function(CZ){switch(CZ.K){case 1:return x=g.dL(e,L),S=g.dL("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(CZ,XE(c,{mode:"readonly",tK:!0},function(IH){return g.qO.all([HV(IH,x,L),HV(IH,S,"musicDownloadsLibraryEntity"),l9(IH,L),l9(IH,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=CZ.X;R=g.f(h);u=R.next().value;t=R.next().value;O=R.next().value;q=R.next().value;T=u;W=t;A=O;b=q;if(!T){CZ.Iq(3);break}return g.a(CZ,OaZ(T,A),4);case 4:return J=CZ.X,g.a(CZ,fd(J),3);case 3:w=[];C=new Map;if(!T){CZ.Iq(6);break}return g.a(CZ,qAZ(T,A,W),7);case 7:w=CZ.X;y=g.f(w);for(P=y.next();!P.done;P=y.next())ev=P.value,X=g.QB(ev).entityId,C.set(X,{videoId:X,playlistId:e,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.a(CZ,n9(c,"transfer"),8);case 8:for(oH=CZ.X,
rc=g.f(oH),Sv=rc.next();!Sv.done;Sv=rc.next())tJ=Sv.value,cM=g.QB(tJ.key).entityId,(JJ=C.get(cM))&&tJ&&(JJ.cotn=tJ.cotn);case 6:yr=[];cU=g.f(b);for($N=cU.next();!$N.done;$N=cU.next())fZ=$N.value,$n=g.QB(fZ.key).entityId,nZ=sM(fZ),$n!==e&&nZ.rootActionId!==e||Tt(I,fZ.actionProto)||yr.push(fZ.key);Mg=g.dL(e,L);return g.a(CZ,XE(c,{mode:"readwrite",tK:!0},function(IH){var wM=yr.map(function(F){return d6(IH,F)});
wM.push(d6(IH,Mg,{X5:!0}));return g.qO.all(wM)}),9);
case 9:if(!T){CZ.Iq(0);break}w.reverse();if(!w.length){CZ.Iq(0);break}QM=g.f(w);Is=QM.next();case 12:if(Is.done){CZ.Iq(0);break}D=Is.value;Zt=g.QB(D).entityId;if(!Zt){CZ.Iq(13);break}return g.a(CZ,Gt(Zt,c,I,B,C.get(Zt)),13);case 13:Is=QM.next(),CZ.Iq(12)}})},kS=function(e,L,c){var I,B,x,S,h,R,u;
return g.Z(function(t){if(t.K==1)return g.a(t,XE(e,{mode:"readwrite",tK:!0},function(O){var q=l9(O,"transfer"),T=l9(O,"offlineOrchestrationActionWrapperEntity");return g.qO.all([q,T]).then(function(W){W=g.f(W);var A=W.next().value;var b=W.next().value;W=Tk9.map(function(y){return n7N(O,y)});
b=g.f(b);for(var J=b.next();!J.done;J=b.next()){J=J.value;var w=g.QB(J.actionProto.entityKey).entityType==="musicTrack",C=J.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Tt(L,J.actionProto)||w&&(!w||C)||W.push(d6(O,J.key,{X5:!0}))}return g.qO.all(W).then(function(){return A})})}),2);
I=t.X;B=g.f(I);for(x=B.next();!x.done;x=B.next())S=x.value,Wg(S),h=g.QB(S.key).entityId,R={videoId:h,offlineDeleteReason:void 0,cotn:S.cotn},rn(R),u=g.dL(h,"musicTrack"),o4(c,{entityKey:u,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.a(t,nA7(),0)})},Wa9=function(e){for(var L,c=g.f(e.additionalMetadatas),I=c.next();!I.done;I=c.next())I=I.value,I.offlineMusicVideoData&&(L=I.offlineMusicVideoData);
var B,x,S,h,R;return{id:g.dL(e.videoId,"musicTrack"),videoId:e.videoId,title:e.title,thumbnailDetails:e.thumbnail,lengthMs:String(Number(e.lengthSeconds)*1E3),albumTitle:(B=L)==null?void 0:B.releaseTitle,musicVideoType:(x=L)==null?void 0:x.musicVideoType,contentRating:{explicitType:(S=L)==null?void 0:S.explicitType},artistNames:((h=L)==null?void 0:h.byline)||((R=L)==null?void 0:R.channelName),downloadMetadata:g.dL(e.videoId,"musicTrackDownloadMetadataEntity")}},qAZ=function(e,L,c){var I,B,x,S,h,R,
u,t,O,q,T,W,A,b,J,w,C,y;
return g.Z(function(P){I=[];B=new Set;if((x=c)==null?0:(S=x.downloadedTracks)==null?0:S.length)for(h=g.f(c.downloadedTracks),R=h.next();!R.done;R=h.next())u=R.value,B.add(u);if(e.tracks){t=g.f(e.tracks);for(O=t.next();!O.done;O=t.next())q=O.value,B.has(q)||I.push(q);T=g.f(L);for(W=T.next();!W.done;W=T.next())if(A=W.value,A.id!==e.id&&(b=A.tracks))for(J=g.f(b),w=J.next();!w.done;w=J.next())C=w.value,y=I.indexOf(C),y!==-1&&I.splice(y,1)}return P.return(I)})},OaZ=function(e,L){var c,I,B,x,S,h,R,u;
return g.Z(function(t){c=MH(e.thumbnailDetails);I=g.f(L);for(B=I.next();!B.done;B=I.next())if(x=B.value,x.id!==e.id)for(S=g.f(MH(x.thumbnailDetails)),h=S.next();!h.done;h=S.next())R=h.value,u=c.indexOf(R),u!==-1&&c.splice(u,1);return t.return(c)})},M1L=function(e,L){var c,I,B,x,S,h,R,u,t;
return g.Z(function(O){if(O.K==1)return c=g.dL("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(O,YU(e,c,"musicDownloadsLibraryEntity"),2);(I=O.X)||(I={id:c});B=g.QB(L).entityType;B==="musicTrack"?(x=I.downloadedTracks)!=null&&x.includes(L)||(I.downloadedTracks=((S=I.downloadedTracks)!=null?S:[]).concat(L)):B==="musicPlaylist"?(h=I.downloadedPlaylists)!=null&&h.includes(L)||(I.downloadedPlaylists=((R=I.downloadedPlaylists)!=null?R:[]).concat(L)):B!=="musicAlbumRelease"||(u=I.downloadedAlbumReleases)!=
null&&u.includes(L)||(I.downloadedAlbumReleases=((t=I.downloadedAlbumReleases)!=null?t:[]).concat(L));return g.a(O,K9(e,I,"musicDownloadsLibraryEntity"),0)})},zLU=function(e,L){var c,I,B,x,S,h,R;
return g.Z(function(u){if(u.K==1)return c=g.dL("music_downloads_library_id","musicDownloadsLibraryEntity"),g.a(u,YU(e,c,"musicDownloadsLibraryEntity"),2);I=u.X;if(!I)return u.Iq(0);B=g.QB(L).entityType;B==="musicTrack"?x=I.downloadedTracks:B==="musicPlaylist"&&(x=I.downloadedPlaylists);if((S=x)==null?0:S.length)for(h=0;h<x.length;h++)if(R=x[h],R===L){x.splice(h,1);break}return g.a(u,K9(e,I,"musicDownloadsLibraryEntity"),0)})},sdw=function(e){var L=e.videos;
e=[];var c=[];if(L){L=g.f(L);for(var I=L.next();!I.done;I=L.next()){var B=I.value.offlineVideoData.videoId;I=g.dL(B,"musicTrack");B=g.dL(B,"musicTrackDownloadMetadataEntity");e.push(I);c.push(B)}}return{mT:e,HE:c}},Dg=function(e,L,c){L={track:Wa9(L)};
c&&(L.playlistId=c);if(e=g.Q(e.actionMetadata,vdL))L.maximumDownloadQuality=e.maximumDownloadQuality;return{musicTrackEntityActionMetadata:L}},AUN=function(e){var L,c,I,B,x,S,h,R;
return g.Z(function(u){switch(u.K){case 1:return L=g.ji(),c=vAM(e),I=g.d9(fXN),g.bn(u,2),x={B1:!0},g.a(u,g.w_(L,c,I,void 0,x),4);case 4:B=u.X;g.DR(u,3);break;case 2:S=g.wc(u);if(S instanceof g.Ze)throw h="GetOffline network manager error: "+S.message,Bg(h,S),Error(h);Bg("GetOffline fetch request error",S);throw Error("GetOffline fetch request error");case 3:R=wn(B);if(!B)throw Bg("Network request failed"),Error("Network request failed");if(R!==void 0)Js(R);else if(!B.videos||!B.videos.length)throw Bg("No data"),
Error("No data");return u.return(B.videos.map(function(t){return t.offlineVideoData}))}})},Fae=function(e){var L,c,I,B,x,S,h,R;
return g.Z(function(u){switch(u.K){case 1:return L=g.ji(),c=fSJ(e),I=g.d9(fXN),g.bn(u,2),x={B1:!0},g.a(u,g.w_(L,c,I,void 0,x),4);case 4:B=u.X;g.DR(u,3);break;case 2:S=g.wc(u);if(S instanceof g.Ze)throw h="GetOffline network manager error for playlist: "+S.message,Bg(h,S),Error(h);Bg("GetOffline fetch request error for playlist",S);throw Error("GetOffline fetch request error for playlist");case 3:R=wn(B);if(!B)throw Bg("Network request failed for playlist"),Error("Network request failed for playlist");
if(R!==void 0)Js(R,"playlist");else if(!B.playlists||!B.playlists.length)throw Bg("No data for playlist"),Error("No data for playlist");return u.return(B.playlists.map(function(t){return t.offlinePlaylistData}))}})},iaM=function(e,L,c,I){var B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ;
return g.Z(function($n){switch($n.K){case 1:return g.a($n,eV(),2);case 2:B=$n.X;if(!B)return $n.return([]);x=[];if((S=I)==null?0:S.length){x=I;$n.Iq(3);break}return g.a($n,n9(B,"mainPlaylistEntity"),4);case 4:x=$n.X;case 3:if(!x.length)return $n.return([]);h=[];R=Date.now()/1E3;u=g.f(x);t=u.next();case 5:if(t.done)return h.length?g.a($n,baN(h),10):$n.return([]);O=t.value;if(!O.downloadState){q=void 0;$n.Iq(8);break}return g.a($n,YU(B,O.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:q=
$n.X;case 8:T=q;W=void 0;b=(A=(W=O)==null?void 0:W.entityMetadata)&&A.nextAutoRefreshIntervalSeconds?Number(A.nextAutoRefreshIntervalSeconds):NaN;J=Number.isNaN(b)?e:b;C=w=void 0;y=((w=T)==null?0:w.lastSyncedTimestampMillis)?Number((C=T)==null?void 0:C.lastSyncedTimestampMillis)/1E3:0;ev=P=void 0;X=((P=T)==null?0:P.addedTimestampMillis)?Number((ev=T)==null?void 0:ev.addedTimestampMillis)/1E3:0;if(c||!A||y+J<=R){oH=[];rc=void 0;if((rc=O.videos)==null?0:rc.length)for(Sv=g.f(O.videos),tJ=Sv.next();!tJ.done;tJ=
Sv.next())cM=tJ.value,JJ=JSON.parse(g.QB(cM).entityId),JJ.videoId&&oH.push(JJ.videoId);yr="0";A&&(cU=void 0,yr=String(Number((cU=A.offlineLastModifiedTimestampSeconds)!=null?cU:0).toFixed()));$N={playlistId:O.playlistId,videoIds:oH,offlineLastModifiedTimestamp:yr,autoSync:L,offlineDateAddedTimestamp:String(X.toFixed())};h.push($N)}t=u.next();$n.Iq(5);break;case 10:return fZ=$n.X,$n.return(fZ)}})},Gae=function(){var e,L,c,I,B;
return g.Z(function(x){if(x.K==1)return g.a(x,eV(),2);if(x.K!=3)return(e=x.X)?g.a(x,n9(e,"refresh"),3):x.return(!1);L=x.X;if((c=L[0])==null||!c.refreshTime)return x.return(!1);I=Number(L[0].refreshTime);B=Date.now()/1E3;return x.return(isFinite(I)&&B>=I)})},kaw=function(e,L){var c,I,B;
return g.Z(function(x){switch(x.K){case 1:return g.bn(x,2),g.a(x,gdZ(e,L),4);case 4:return I=x.X,g.a(x,odU(I),5);case 5:c=rU7(I);g.DR(x,3);break;case 2:B=g.wc(x),Bg("getAndProcessSmartDownloadsResponse request or processing error",B);case 3:return x.return(c)}})},DkU=function(e,L,c,I){var B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ;
return g.Z(function($n){switch($n.K){case 1:return g.a($n,eV(),2);case 2:B=$n.X;if(!B)return $n.return([]);x=[];if((S=I)==null?0:S.length){x=I;$n.Iq(3);break}return g.a($n,n9(B,"musicPlaylist"),4);case 4:x=$n.X;case 3:if(!x.length)return $n.return([]);h=[];R=Date.now()/1E3;u=g.f(x);t=u.next();case 5:if(t.done)return h.length?g.a($n,baN(h),10):$n.return([]);O=t.value;q=void 0;W=(T=(q=O)==null?void 0:q.entityMetadata)&&T.nextAutoRefreshIntervalSeconds?Number(T.nextAutoRefreshIntervalSeconds):NaN;A=
Number.isNaN(W)?e:W;J=b=0;w="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!O.downloadMetadata){$n.Iq(8);break}return g.a($n,YU(B,O.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:C=$n.X,P=y=void 0,b=Number((P=(y=C)==null?void 0:y.addedTimestampMillis)!=null?P:"0")/1E3,X=ev=void 0,J=Number((X=(ev=C)==null?void 0:ev.lastModifiedTimestampMillis)!=null?X:"0")/1E3,rc=oH=void 0,w=(rc=(oH=C)==null?void 0:oH.syncState)!=null?rc:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Sv=void 0;if(c||w!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!T||Number((Sv=T.lastSyncedTimestampSeconds)!=null?Sv:0)+A<=R){tJ=[];cM=void 0;if((cM=O.tracks)==null?0:cM.length)for(JJ=g.f(O.tracks),yr=JJ.next();!yr.done;yr=JJ.next())cU=yr.value,tJ.push(g.QB(cU).entityId);$N={playlistId:O.playlistId,videoIds:tJ,offlineLastModifiedTimestamp:String(J.toFixed()),autoSync:L,offlineDateAddedTimestamp:String(b.toFixed())};h.push($N)}t=u.next();$n.Iq(5);break;case 10:return fZ=$n.X,$n.return(fZ)}})},gdZ=function(e,L){var c,I,B,x,S,h,R,u,t,O;
return g.Z(function(q){switch(q.K){case 1:return c=g.ji(),g.a(q,eV(),2);case 2:I=q.X;if(!I){q.Iq(3);break}return g.a(q,k4N(I),4);case 4:B=q.X;case 3:var T=B;x={context:g.l1(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:e},offlineClientState:T,clientStateRequestData:{preferredFormatType:L}}}};S=g.d9(w0L);g.bn(q,5);R={B1:!0};return g.a(q,g.w_(c,x,S,void 0,R),7);case 7:h=q.X;g.DR(q,6);break;case 5:u=g.wc(q);if(u instanceof g.Ze)throw t=
"DPS network manager error for smart downloads: "+u.message,Bg(t,u),Error(t);Bg("DPS fetch request error for smart downloads",u);throw Error("DPS fetch request error for smart downloads");case 6:O=wn(h);if(h)O!==void 0&&Js(O,"smart downloads");else throw Bg("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return q.return(h)}})},V1e=function(e,L){var c,I,B,x,S,h,R,u;
return g.Z(function(t){switch(t.K){case 1:return c=g.ji(),I={context:g.l1(),videoPlaybackPositionEntities:e,lastSyncTimestampUsec:L},B=g.d9(JUe),g.bn(t,2),S={B1:!0},g.a(t,g.w_(c,I,B,void 0,S),4);case 4:x=t.X;g.DR(t,3);break;case 2:h=g.wc(t);if(h instanceof g.Ze)throw R="VPPS network manager error: "+h.message,Bg(R,h),Error(R);Bg("VPPS fetch request error",h);throw Error("VPPS fetch request error");case 3:u=wn(x);if(x)u!==void 0&&Js(u,"position sync");else throw Bg("Network request failed for position sync"),
Error("Network request failed for position sync");return t.return(x)}})},aXL=function(e,L,c){var I,B,x,S,h,R,u,t;
return g.Z(function(O){switch(O.K){case 1:I=g.ji();var q=c.refreshData,T=c.isEnqueuedForExpiredStreamUrlRefetch,W=c.yj,A=c.offlineSourceData,b=c.mediaCapabilities,J={entityKey:e};q&&(J.refreshData=q);T&&(J.isExpiredStreamUrlRefetch=T);W&&(J.downloadParameters=W);A&&(J.offlineSourceData=A);q={context:g.MU(L),signatureTimestamp:20278,videos:[J]};b&&(q.mediaCapabilities=b);B=q;x=g.d9(CrL);g.bn(O,2);h={B1:!0};return g.a(O,g.w_(I,B,x,void 0,h),4);case 4:S=O.X;g.DR(O,3);break;case 2:R=g.wc(O);if(R instanceof
g.Ze)throw u="GetPDE network manager error: "+R.message,Bg(u,R),Error(u);Bg("GetPDE fetch request error",R);throw Error("GetPDE fetch request error");case 3:t=wn(S);if(S)t!==void 0&&Js(t,"PDE");else throw Bg("Network request failed for PDE"),Error("Network request failed for PDE");return O.return(S)}})},wn=function(e){var L;
return(L=e.errorMetadata)==null?void 0:L.status},Js=function(e,L){L=L?" for "+L:"";
if(e===0)throw e="Empty response body"+L,Bg(e),Error(e);e="Response with error"+L;Bg(e);throw Error(e);},baN=function(e){var L,c,I,B,x,S,h,R;
return g.Z(function(u){switch(u.K){case 1:return L=g.ji(),c=AiM(e),I=g.d9(NkN),g.bn(u,2),x={B1:!0},g.a(u,g.w_(L,c,I,void 0,x),4);case 4:B=u.X;g.DR(u,3);break;case 2:S=g.wc(u);if(S instanceof g.Ze)throw h="offlinePlaylistSyncCheck network manager error: "+S.message,Bg(h,S),Error(h);Bg("offlinePlaylistSyncCheck fetch request error",S);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:R=wn(B);if(!B)throw Bg("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(R!==void 0)Js(R,"playlist sync");else if(!B.offlinePlaylistSyncCheckDatas||!B.offlinePlaylistSyncCheckDatas.length)throw Bg("No data for playlist sync"),Error("No data for playlist sync");return u.return(B.offlinePlaylistSyncCheckDatas.map(function(t){return t.offlinePlaylistSyncCheckData}))}})},Vx=function(e){this.X=e},mkh=function(e,L){var c,I,B,x,S,h;
return g.Z(function(R){switch(R.K){case 1:c=new Map,I=g.f(L),B=I.next();case 2:if(B.done){R.Iq(4);break}x=B.value;S=c;h=S.set;return g.a(R,e.K(x),5);case 5:h.call(S,x,R.X);B=I.next();R.Iq(2);break;case 4:return R.return(c)}})},Cd=function(e,L,c,I,B,x){L=g.dL(L,c);
I=Object.assign({},x,{priority:I,retryScheduleIntervalsInSeconds:B});return{actionType:e,entityKey:L,actionMetadata:I}},a4=function(e,L,c,I,B,x){this.status=e;
this.X=L;this.G=c;this.K=I;this.Z=B;this.downloadState=x},yUL=function(e,L,c){this.X=e;
this.XM=L;this.Z=c},$kL=function(e,L){var c,I,B,x,S,h,R,u,t;
return g.Z(function(O){switch(O.K){case 1:return c=L.entityKey,B=(I=g.Q(L.actionMetadata,NH))==null?void 0:I.isEnqueuedForExpiredStreamUrlRefetch,g.bn(O,2),x=void 0,g.a(O,ZaM(e,L),4);case 4:x=O.X;g.bn(O,5);var q=(q=g.Q(L.actionMetadata,NH))?{maximumDownloadQuality:q.maximumDownloadQuality}:void 0;return g.a(O,aXL(c,e.XM,{isEnqueuedForExpiredStreamUrlRefetch:B,yj:q,offlineSourceData:x}),7);case 7:S=O.X;g.DR(O,6,2);break;case 5:return g.wc(O,2),h=R4(L)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Bg("PDE handleAdd error"),O.return(mi(L,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",h,"DOWNLOAD_STATE_FAILED"));case 6:return g.a(O,p0L(e,S,L),8);case 8:return O.return(mi(L,!0,S.orchestrationActions));case 2:return R=g.wc(O),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.St&&R.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Bg("PDE handleAdd error"),O.return(mi(L,!1,void 0,u,t,"DOWNLOAD_STATE_FAILED"))}})},lXM=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc;
return g.Z(function(Sv){switch(Sv.K){case 1:return c=L.entityKey,I=g.QB(c).entityId,g.a(Sv,XE(e.X,{mode:"readonly",tK:!0},function(tJ){var cM=HV(tJ,c,"playbackData"),JJ=HV(tJ,g.dL(I,"offlineVideoPolicy"),"offlineVideoPolicy");tJ=HV(tJ,g.dL(I,"transfer"),"transfer");return g.qO.all([cM,JJ,tJ])}),2);
case 2:B=Sv.X;x=g.f(B);S=x.next().value;h=x.next().value;R=x.next().value;u=S;t=h;O=R;if(!u||!t)return Sv.return(mi(L,!0));q=[];A=((W=u)==null?0:W.playerResponseJson)?JSON.parse(u.playerResponseJson):null;if(!(O&&A&&e.XM.Y("html5_refresh_deprecated_downloads"))){Sv.Iq(3);break}T=jd7(e,A,O);return g.a(Sv,Ha7(e,O),4);case 4:q=Sv.X;case 3:b={lastPlayerResponseTimestampSeconds:u.playerResponseTimestamp,offlineToken:t.offlineToken,formatIds:q};J={};if((w=O)==null?0:w.maximumDownloadQuality)J.maximumDownloadQuality=
O.maximumDownloadQuality;g.bn(Sv,5);C=void 0;return g.a(Sv,ZaM(e,L),7);case 7:return C=Sv.X,g.bn(Sv,8),g.a(Sv,aXL(c,e.XM,{refreshData:b,yj:J,offlineSourceData:C,mediaCapabilities:T}),10);case 10:y=Sv.X;g.DR(Sv,9,5);break;case 8:return g.wc(Sv,5),P=R4(L)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Bg("PDE handleRefresh error"),Sv.return(mi(L,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",P,
"DOWNLOAD_STATE_FAILED"));case 9:return g.a(Sv,p0L(e,y,L),11);case 11:return Sv.return(mi(L,!0,y.orchestrationActions));case 5:return ev=g.wc(Sv),X="PDE handleRefresh error",ev instanceof Error&&(X="PDE handleRefresh error: "+ev.message),oH="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",rc="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ev instanceof g.St&&ev.type==="QUOTA_EXCEEDED"&&(oH="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",rc="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Bg(X),Sv.return(mi(L,!1,void 0,oH,rc,"DOWNLOAD_STATE_FAILED"))}})},ZaM=function(e,L){var c,I,B,x;
return g.Z(function(S){if(S.K==1)return c=g.QB(L.entityKey).entityId,I=g.dL(c,"videoDownloadContextEntity"),g.a(S,YU(e.X,I,"videoDownloadContextEntity"),2);B=S.X;return(x=B)!=null&&x.offlineModeType?S.return({offlineModeType:B.offlineModeType}):S.return(void 0)})},p0L=function(e,L,c){var I,B,x,S,h;
return g.Z(function(R){if(R.K==1){if(!L.frameworkUpdates||!g.Q(L.frameworkUpdates,b4))return R.return();if(!(g.Q(L.frameworkUpdates,b4).mutations&&g.Q(L.frameworkUpdates,b4).mutations.length>0&&g.Q(L.frameworkUpdates,b4).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return R.Iq(2);I=g.QB(g.Q(L.frameworkUpdates,b4).mutations[0].entityKey).entityId;return g.a(R,i4(e.X,I),3)}if(R.K!=2){B=R.X;x=g.Q(c.actionMetadata,NH);if(h=(S=x)==null?void 0:S.playlistId)B.playlistId=h;B.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.T3(e.XM)?g.a(R,Ff(I,e.X,c,e.Z,B),2):g.DF(e.XM)?g.a(R,Gt(I,e.X,c,e.Z),2):R.Iq(2)}return g.a(R,tAL(g.Q(L.frameworkUpdates,b4)),0)})},mi=function(e,L,c,I,B,x){return new a4(L?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",R4(e),c,I,B,x)},jd7=function(e,L,c){L=Kch(e.XM,c.cotn,L);
c=g.g7(L);return g.T3x(L,c,e.XM)},Ha7=function(e,L){var c,I,B,x,S,h,R,u,t,O,q;
return g.Z(function(T){if(T.K==1)return c=[],g.a(T,XE(e.X,{mode:"readonly",tK:!0},function(W){var A=[],b=L.offlineVideoStreams;if(b){b=g.f(b);for(var J=b.next();!J.done;J=b.next())A.push(HV(W,J.value,"offlineVideoStreams"))}return g.qO.all(A)}),2);
if(I=T.X)for(B=g.f(I),x=B.next();!x.done;x=B.next())if(S=x.value,h=void 0,(h=S)==null?0:h.streamsProgress)for(R=S.streamsProgress,u=0;u<R.length;u++)t=R[u],O=JSON.parse(t.formatStreamBytes),q={itag:O.itag,lmt:O.lastModified,xtags:O.xtags},c.push(q);return T.return(c)})},Prw=function(e,L){this.X=e;
this.XM=L},QdN=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T;
return g.Z(function(W){switch(W.K){case 1:return c=R4(L),g.a(W,n9(e.X,"videoPlaybackPositionEntity"),2);case 2:I=W.X;if(I.length===0)return W.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.bn(W,3);return g.a(W,p9.getInstance(),5);case 5:B=W.X;if(!B)throw Error("prefStorage is undefined");return g.a(W,B.get("psi"),6);case 6:return x=W.X,R=(h=(S=x)==null?void 0:S.iX)!=null?h:"0",g.a(W,V1e(I,R),7);case 7:return u=W.X,t={isPaused:u.watchHistoryPaused,iX:u.syncTimestampUsec},g.a(W,B.set("psi",
t),8);case 8:if(t.isPaused){W.Iq(9);break}O=g.Q(u.frameworkUpdates,b4);if(!u.frameworkUpdates||!O){W.Iq(9);break}return g.a(W,tAL(O),9);case 9:g.DR(W,4);break;case 3:return q=g.wc(W),T="PPE handleRefresh error: "+(q instanceof Error?q.message:"unknown error"),Bg(T),W.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return W.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},UkM=function(e,L){var c,I,B,x,S,h,R,u;
return g.Z(function(t){switch(t.K){case 1:return c=R4(L),I=g.QB(L.entityKey).entityId,g.bn(t,2),g.a(t,p9.getInstance(),4);case 4:B=t.X;if(!B)throw Error("prefStorage is undefined");return g.a(t,B.get("psi"),5);case 5:x=t.X;S=g.Q(L.actionMetadata,dkZ);if(((h=x)==null?void 0:h.isPaused)!==!1||(R=S)==null||!R.lastPlaybackPositionSeconds){t.Iq(6);break}u={key:g.dL(I,"videoPlaybackPositionEntity"),videoId:I,lastPlaybackPositionSeconds:S.lastPlaybackPositionSeconds};return g.a(t,K9(e.X,u,"videoPlaybackPositionEntity"),
6);case 6:g.DR(t,3);break;case 2:return g.wc(t),t.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return t.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},Edw=function(e,L){var c,I,B;
return g.Z(function(x){switch(x.K){case 1:c=R4(L);g.bn(x,2);I=g.QB(L.entityKey).entityId;if(I==="!*$_ALL_ENTITIES_!*$")return g.a(x,Sae(e.X),5);B=g.dL(I,"videoPlaybackPositionEntity");return g.a(x,oAZ(e.X,B),5);case 5:g.DR(x,3);break;case 2:return g.wc(x),x.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},X0Z=function(e,L){this.api=e;
this.X=L;this.logger=new g.tB("woffle");this.K=!1;this.kx={cO:this.cO};this.logger.debug("Initialized OfflineMediaManager")},KaN=function(e){return g.Z(function(L){return L.return(s$N(e))})},YAJ=function(e){var L;
return g.Z(function(c){if(c.K==1)return g.a(c,g.lCv(e),2);L=c.X;return c.return(L.filter(function(I){return!!I.url}).map(function(I){return I.url}))})},yx=function(e,L){var c=g.XM(L);
if(c===1||c===0)return Promise.resolve();(c=nde(e,L))&&c.stopVideo();e.Z=0;return KaN(L)},Zg=function(e,L,c,I){c=c===void 0?!1:c;
I=I===void 0?!0:I;var B=typeof L==="string"?L:L.videoDetails.videoId;g.XM(B)===2&&((L=nde(e,B))?L.stopVideo():e.logger.info(function(){return"Corresponding player for "+B+" not found. Pausing anyway"}),g.K8(B,2),e.Z=2,c?eDL(e.X):I&&Lng(e.X))},nde=function(e,L){var c;
return((c=e.player)==null?void 0:c.getVideoData().videoId)===L?e.player:null},cSN=function(e,L,c){L.getPlayerResponse();
g.K8(L.videoId,2);e.Z=2;e.K=!1;var I;(I=e.player)==null||I.dispose();e.player=e.api.J4(L);L={};e.player.xw((L.localmediachange=e.dD,L.signatureexpired=e.Sx,L.statechange=e.HSq,L),e);var B=e.cO(c);e.player.fd(g.sg(B,B,!0,"m"),!1);e.logger.debug(function(){return"Starting headless playback with quality: "+B});
e.player.WH(!1)},I$9=function(e,L){this.X=e;
this.XM=L},xAw=function(e,L){var c,I;
return g.Z(function(B){switch(B.K){case 1:return c=R4(L),g.a(B,YU(e.X,L.entityKey,"transfer"),2);case 2:if(I=B.X)return B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.bn(B,3);return g.a(B,BGe(e,L),5);case 5:g.DR(B,4);break;case 3:return g.wc(B),B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},o4N=function(e,L){var c,I;
return g.Z(function(B){switch(B.K){case 1:return c=R4(L),g.a(B,YU(e.X,L.entityKey,"transfer"),2);case 2:I=B.X;if(!I||I.transferState!=="TRANSFER_STATE_COMPLETE")return B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.bn(B,3);return g.a(B,BGe(e,L,!0),5);case 5:g.DR(B,4);break;case 3:return g.wc(B),B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},S1e=function(e,L){var c,I,B,x,S,h,R,u,t,O;
return g.Z(function(q){switch(q.K){case 1:return c=R4(L),I=g.QB(L.entityKey).entityId,g.a(q,XE(e.X,{mode:"readonly",tK:!0},function(T){var W=HV(T,L.entityKey,"transfer");T=HV(T,g.dL(I,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.qO.all([W,T])}),2);
case 2:B=q.X;x=g.f(B);S=x.next().value;h=x.next().value;R=S;u=h;if(!R||R.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return q.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.bn(q,3);R.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.a(q,K9(e.X,R,"transfer"),5);case 5:t=g.QB(R.key).entityId;Pqh({videoId:t,zc:R,offlineModeType:(O=u)==null?void 0:O.offlineModeType});g.DR(q,4);break;case 3:return g.wc(q),q.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},BGe=function(e,L,c){c=c===void 0?!1:c;
var I,B,x,S,h,R,u,t,O,q,T,W,A,b,J;return g.Z(function(w){switch(w.K){case 1:return I=g.Q(L.actionMetadata,rSh),B=g.QB(L.entityKey).entityId,x=g.dL(B,"downloadStatusEntity"),g.a(w,XE(e.X,{mode:"readonly",tK:!0},function(C){var y=HV(C,x,"downloadStatusEntity");C=HV(C,g.dL(B,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.qO.all([y,C])}),2);
case 2:return S=w.X,h=g.f(S),R=h.next().value,u=h.next().value,t=R,O=u,q="TRANSFER_STATE_TRANSFER_IN_QUEUE",((T=t)==null?void 0:T.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(q="TRANSFER_STATE_PAUSED_BY_USER"),b={key:L.entityKey,transferState:q,cotn:g.Rp(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(W=I)==null?void 0:W.maximumDownloadQuality,preferredAudioTrack:(A=I)==null?void 0:A.preferredAudioTrack,transferRetryCount:0,isRefresh:c,hasLoggedFirstStarted:!1},g.a(w,XE(e.X,
{mode:"readwrite",tK:!0},function(C){var y=[];c&&y.push(d6(C,g.dL(B,"offlineVideoStreams")));y.push(Qs(C,b,"transfer"));return g.qO.all(y)}),3);
case 3:if(!c){w.Iq(4);break}return g.a(w,KaN(B),4);case 4:HcZ({videoId:B,zc:b,offlineModeType:(J=O)==null?void 0:J.offlineModeType}),g.AJ(w)}})},RDM=function(e,L,c,I){if(!e.action.entityKey)throw Error("entityKey is missing.");
var B=g.QB(e.action.entityKey);B={entityType:B.bY,entityId:B.entityId,offlineOrchestrationActionType:e.action.actionType,orchestrationAction:{orchestrationActionId:e.actionId}};L&&(B.offlineOrchestrationActionResult=L.status,B.isRetryable=c?!1:L.X,L.Z&&(B.offlineOrchestrationFailureReason=hDJ(L.Z,B.isRetryable)));var x,S;if((x=e.action.actionMetadata)==null?0:(S=x.offlineLoggingData)==null?0:S.offlineModeType)B.offlineModeType=e.action.actionMetadata.offlineLoggingData.offlineModeType;I&&(B.additionalOrchestrationActions=
I.map(function(h){return{orchestrationActionId:h.actionId}}));
return B},hDJ=function(e,L){return e!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||L?e==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&L?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":e:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},uVM=function(e,L){var c={offlineOrchestrationContext:RDM(e)};
L=G4N(L,c);gAg(icM(),L,e.rootActionId)},t9h=function(e,L,c,I){I=I===void 0?[]:I;
L={offlineOrchestrationContext:RDM(e,L,c,I)};L=G4N(3,L);gAg(icM(),L,e.rootActionId)},Osw=function(){this.actions=[]},q1e=function(e,L){L=g.f(L);
for(var c=L.next();!c.done;c=L.next())c=c.value,uVM(c,1),e.actions.push(c);e.actions.sort(e.X)},TGh=function(e,L){if(L)for(var c=0;c<e.actions.length;c++)if(L==="!*$_ALL_ENTITIES_!*$"&&e.actions[c].actionId!==L||L!=="!*$_ALL_ENTITIES_!*$"&&e.actions[c].rootActionId===L&&e.actions[c].actionId!==L)e.actions.splice(c,1),c--},Wn9=function(e,L){e=g.f(e.actions);
for(var c=e.next();!c.done;c=e.next())if(c.value.actionId===L)return!0;return!1},pd=function(e,L,c,I,B){g.p.call(this);
var x=this;this.K=e;this.Gm=L;this.pS=c;this.T=I;this.XM=B;this.X=new Osw;this.j=new g.af;this.Z=new g.j9(function(){x.retry()});
this.J=NaN;this.B=!1;this.kx={i8l:function(){return x.X},
v9:function(){return x.j},
X10:function(){return x.Z},
retry:function(){return x.retry()}};
g.l(this,this.Z);this.D=this.K.observe(this.h7.bind(this))},sbM=function(e,L,c,I,B){var x;
return g.Z(function(S){if(S.K==1)return x=new pd(e,L,c,I,B),g.a(S,M9L(x),2);zDU(x);return S.return(x)})},zDU=function(e){var L=e.X.actions[0];
return e.G?((L==null?void 0:L.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&e.G[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(e.B=!0),Promise.resolve()):v47(e)},v47=function(e){var L,c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J;
return g.Z(function(w){switch(w.K){case 1:if(e.G)throw Error("Already processing an action");if(e.We())return w.return();L=e.X.actions.shift();$qe(e.pS,!L);if(L===void 0)return w.return();L.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&L.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&TGh(e.X,L.actionId);c="";L.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&L.rootActionId===L.actionId&&(c=L.actionId);I=[L];e.G=I;if(B=e.Gm[L.entityType]){w.Iq(2);break}e.G=
void 0;return g.a(w,v47(e),3);case 3:return w.return();case 2:x=g.f(I);for(S=x.next();!S.done;S=x.next())h=S.value,uVM(h,2);g.bn(w,4,5);return g.a(w,mkh(B,I.map(function(C){return C.action})),7);
case 7:R=w.X,u=g.f(I),t=u.next();case 8:if(t.done){w.Iq(10);break}O=t.value;q=R.get(O.action);return g.a(w,f$M(e,O,q),9);case 9:t=u.next();w.Iq(8);break;case 10:TGh(e.X,c);case 5:g.NM(w);e.G=void 0;g.mf(w,6);break;case 4:return T=g.wc(w),Bg("Orchestration error",T),g.bn(w,12),g.a(w,AS7(e,I),14);case 14:g.DR(w,5);break;case 12:W=g.wc(w);Bg("Orchestration retry error",W);A=g.f(I);for(b=A.next();!b.done;b=A.next())J=b.value,J.retryScheduleIndex<3&&q1e(e.X,[J]);w.Iq(5);break;case 6:return g.a(w,v47(e),
0)}})},f$M=function(e,L,c){var I,B,x,S,h,R,u,t,O,q,T,W;
return g.Z(function(A){switch(A.K){case 1:I=L.retryScheduleIndex+2===3;if(c.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){A.Iq(2);break}if(c.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){A.Iq(0);break}t9h(L,c,I);if(c.X&&L.retryScheduleIndex+1<3)return g.a(A,AS7(e,[L]),0);x=((B=c)==null?0:B.K)?c.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";S={entityKey:L.action.entityKey,failureReason:x};h=void 0;g.T3(e.XM)?h="mainVideoDownloadStateEntity":g.DF(e.XM)&&(h="musicTrackDownloadMetadataEntity");
if(!h||!c.downloadState){A.Iq(7);break}R=g.QB(L.action.entityKey).entityId;return g.a(A,qH(R,h,e.K,c.downloadState),7);case 7:o4(e.T,S);if(c.downloadState==="DOWNLOAD_STATE_FAILED"&&e.XM.Y("html5_auto_retry_failed_pde_actions")){A.Iq(0);break}Bg("Orchestration result is not retryable, deleting action");return g.a(A,oAZ(e.K,vg(L).key),0);case 2:u=void 0;try{u=(t=c.G)==null?void 0:t.map(function(b){return e.createAction(b,L)})}catch(b){return t9h(L,c,I),O={entityKey:L.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},o4(e.T,O),Bg("Orchestration subactions creation error",b),A.return()}t9h(L,c,I,u);if(!u){A.Iq(12);break}q=u.map(function(b){return vg(b)});
T=0;case 13:if(!(T<u.length)||e.B){A.Iq(15);break}return g.a(A,XE(e.K,{mode:"readwrite",tK:!0},function(b){var J=[];J.push(XkL(b,q.slice(T,T+10),"offlineOrchestrationActionWrapperEntity"));return g.qO.all(J)}),16);
case 16:T+=10;A.Iq(13);break;case 15:if(e.B)return e.B=!1,A.return();case 12:return W=vg(L),g.a(A,oAZ(e.K,W.key),17);case 17:uVM(L,4),g.AJ(A)}})},Gfe=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T;
return g.Z(function(W){c=[];I=Infinity;B=4E3;x=g.f(L);for(S=x.next();!S.done;S=x.next())h=S.value,R=Number(h.enqueueTimeSec),u=FnU(R),t=h.retryScheduleIndex,O=t!=null&&t>0,u>0&&O?(I=Math.min(I,R),B=Math.min(u,B)):c.push(h);isFinite(I)&&(!e.Z.isActive()||I<e.J)&&(e.J=I,e.Z.start(B));e.j.y9()||(q=c.length,c=c.filter(function(A){var b;A=((b=A.actionProto)==null?void 0:b.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!bsZ.includes(A)}),T=c.length<q,!e.Z.isActive()&&T&&e.Z.start(1));
c.length>0&&isU(e,c);return g.a(W,zDU(e),0)})},kf9=function(e){var L,c,I,B,x,S,h;
return g.Z(function(R){if(R.K==1)return g.a(R,g4M(e),2);L=R.X;c=[];I=g.f(L);for(B=I.next();!B.done;B=I.next())x=B.value,S=g.QB(x.key),h=S.entityId,Wn9(e.X,h)||c.push(x);return g.a(R,Gfe(e,c),0)})},FnU=function(e){e=e*1E3-Date.now();
return e>4E3?4E3:e},AS7=function(e,L){var c,I,B;
return g.Z(function(x){c=g.f(L);for(I=c.next();!I.done;I=c.next()){B=I.value;var S=void 0,h=void 0,R=((h=B.action)==null?void 0:(S=h.actionMetadata)==null?void 0:S.retryScheduleIntervalsInSeconds)||[1,2,4];S=1;B.retryScheduleIndex<R.length&&(S=R[B.retryScheduleIndex]);B.X=S*1E3+Date.now();B.retryScheduleIndex++}return g.a(x,DAJ(e,L),0)})},M9L=function(e){var L;
return g.Z(function(c){if(c.K==1)return g.a(c,n9(e.K,"offlineOrchestrationActionWrapperEntity"),2);L=c.X;return g.a(c,Gfe(e,L),0)})},isU=function(e,L){L.length!==0&&L.forEach(function(c){c=sM(c);
c.retryScheduleIndex<3&&q1e(e.X,[c])})},g4M=function(e,L){var c;
return g.Z(function(I){if(I.K==1)return g.a(I,n9(e.K,"offlineOrchestrationActionWrapperEntity",L),2);c=I.X;return I.return(c.filter(OcL))})},DAJ=function(e,L){if(L.length===0)return Promise.resolve([]);
L=L.map(function(c){return vg(c)});
return xqw(e.K,L)},wT7=function(e){this.CS=e;
this.X=void 0},JSM=function(e,L){var c,I,B,x;
return g.Z(function(S){c=L.videoId;I=!0;if(L.captionTracks.length)B=llM(L),e.X=new g.Nr(e.CS,L,B);else if(L.pj)x=g.eUv(L),e.X=new g.yk(e.CS,L.pj,c,x,L.hB,L.eventId),I=L.hB;else return S.return();return S.return(new Promise(function(h){var R;(R=e.X)==null||R.Gl({Aa:function(){return g.Z(function(u){if(u.K==1)return g.a(u,e.Aa(c,I),2);h();g.AJ(u)})},
Bo:function(){}})}))})},V9w=function(e){var L;
return g.Z(function(c){if(c.K==1)return g.a(c,zpw(e),2);L=c.X;return c.return(!!L&&L.length>0)})},$S=function(e){g.p.call(this);
this.X=e;this.K=this.X.observe(this.Z.bind(this))},CBN=function(e,L){var c,I,B,x,S,h,R;
return g.Z(function(u){switch(u.K){case 1:if(L.length===0)return u.return([]);c=L.map(function(t){return g.dL(t,"transfer")});
return g.a(u,n9(e.X,"transfer",c),2);case 2:I=u.X;B=I.filter(OcL).map(function(t){return g.QB(t.key).entityId});
x=L.filter(function(t){return B.indexOf(t)===-1});
if(x.length===0)return u.return([]);S=g.f(x);h=S.next();case 3:if(h.done){u.Iq(5);break}R=h.value;return g.a(u,KaN(R),4);case 4:h=S.next();u.Iq(3);break;case 5:return u.return(x)}})},mAN=function(e,L,c,I,B,x){var S,h,R;
return g.Z(function(u){S="STREAM_TYPE_UNKNOWN";c.video&&c.audio?(S="STREAM_TYPE_AUDIO_AND_VIDEO",Bg("unexpected stream type")):c.video&&!c.audio?S="STREAM_TYPE_VIDEO":!c.video&&c.audio&&(S="STREAM_TYPE_AUDIO");h=g.dL(L,"offlineVideoStreams");R={numBytesDownloaded:B.toFixed(),numTotalBytes:x.toFixed(),streamType:S,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(I),itag:S==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(c.itag):void 0};return g.a(u,XE(e,{mode:"readwrite",tK:!0},
function(t){var O=HV(t,h,"offlineVideoStreams"),q=HV(t,g.dL(L,"transfer"),"transfer");return g.qO.all([O,q]).then(function(T){T=g.f(T);var W=T.next().value;T=T.next().value;if(!T)return d6(t,h).then(function(){});
var A=a$g(W);W=NG9(W,I,R,h);var b=Qs(t,W,"offlineVideoStreams");a$g(W)>A&&(T.lastProgressTimeMs=Date.now().toString());A=[b];T.offlineVideoStreams||(T.offlineVideoStreams=[]);T.offlineVideoStreams.indexOf(h)===-1&&(T.offlineVideoStreams.push(h),A.push(Qs(t,T,"transfer")));return g.qO.all(A)})}),0)})},ySh=function(e,L){var c,I,B,x,S;
return g.Z(function(h){if(h.K==1)return c=g.dL(L,"offlineVideoStreams"),g.a(h,YU(e,c,"offlineVideoStreams"),2);I=h.X;if(!I||!I.streamsProgress)return h.return();B=g.f(I.streamsProgress);for(x=B.next();!x.done;x=B.next())S=x.value,S.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",S.numTotalBytes!==S.numBytesDownloaded&&(S.numBytesDownloaded=S.numTotalBytes);return g.a(h,K9(e,I,"offlineVideoStreams"),0)})},NG9=function(e,L,c,I){if(e&&e.streamsProgress){I=e;
a:{L=L.itag+";"+L.xtags;for(var B=e.streamsProgress,x=0;x<B.length;x++){var S=JSON.parse(B[x].formatStreamBytes);if(S.itag+";"+S.xtags===L){B[x]=c;c=B;break a}}B.push(c);c=B}I.streamsProgress=c}else e={key:I,streamsProgress:[c]};return e},a$g=function(e){if(e==null?0:e.streamsProgress){var L=0;
e=e.streamsProgress;for(var c=0;c<e.length;c++){var I=e[c];isNaN(Number(I.numBytesDownloaded))?Bg("stream progress bytes number invalid"):L+=Number(I.numBytesDownloaded)}return L}return 0},ZsM=function(e,L,c,I){g.p.call(this);
var B=this;this.K=e;this.api=L;this.Pe=c;this.h7=I;this.j=new g.af;this.G=new g.j9(function(){B.X&&B.X.transferState==="TRANSFER_STATE_TRANSFERRING"&&B.j.y9()&&((B.X.transferRetryCount||0)<3?Zg(B.T,B.B,!1,!1):yx(B.T,B.B.videoDetails.videoId),B.vG("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.pS=this.Ve=0;this.D=this.J=!1;this.He=g.X3(this.api.S().experiments,"html5_transfer_processing_logs_interval");this.t7=new g.zn(this);this.kx={Gwl:function(){return B.G},
ll_:function(){return B.h7},
v9:function(){return B.j}};
this.Gm=this.K.observe(this.Lc.bind(this));this.T=new X0Z(L,this);this.m$=new wT7(L);this.k9=new $S(this.K);this.Y9=this.j.listen("publicytnetworkstatus-online",this.MJ.bind(this));this.ye=this.j.listen("publicytnetworkstatus-offline",this.Rdm.bind(this));this.D=this.api.S().Y("html5_less_transfer_processing_logs");g.l(this,this.t7);this.t7.C(L,"offlinetransferpause",this.YRW);if(g.T3(this.api.S()))this.Z="mainVideoDownloadStateEntity";else if(g.DF(this.api.S())||g.Mu(this.api.S()))this.Z="musicTrackDownloadMetadataEntity"},
pTh=function(e){return g.Z(function(L){if(L.K==1)L=g.a(L,WcM(),2);
else{var c=e.k9;var I=g.Ej();I=Object.keys(I);c=CBN(c,I);L=g.a(L,c,0)}return L})},Hg=function(e,L){L=L===void 0?!1:L;
var c;return g.Z(function(I){if(I.K==1){if(e.X)throw Error("Already downloading a video");e.pS=0;e.J=!1;return g.a(I,$AZ(e),2)}return I.K!=4?(c=I.X,j$7(e.Pe,!c),c&&e.j.y9()?L?g.a(I,new Promise(function(B){g.oC(B,1E3)}),4):I.Iq(4):(!c&&e.X&&jV(e),I.Iq(0))):g.a(I,jbN(e,c),0)})},Hsh=function(e){return g.Z(function(L){if(L.K==1)return e.B?g.a(L,yx(e.T,e.B.videoDetails.videoId),3):L.Iq(0);
jV(e);g.AJ(L)})},l$e=function(e,L){var c,I,B;
return g.Z(function(x){switch(x.K){case 1:return g.bn(x,2),(c=!!L.captionTracks.length||!!L.pj)?g.a(x,V9w(L.videoId),4):x.return();case 4:return(I=x.X)?x.return():g.a(x,JSM(e.m$,L),5);case 5:g.DR(x,0);break;case 2:B=g.wc(x),Bg("Caption downloading error",B,L.cotn),g.AJ(x)}})},jbN=function(e,L){var c,I,B,x,S,h;
return g.Z(function(R){switch(R.K){case 1:if(e.J)return R.return();e.J=!0;e.X=L;c=g.QB(e.X.key);I=c.entityId;B=void 0;if(e.X.transferState==="TRANSFER_STATE_TRANSFERRING")return g.a(R,l4(e,I),7);if(e.X.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||e.X.transferRetryCount||e.X.hasLoggedFirstStarted){R.Iq(3);break}return g.a(R,l4(e,I),5);case 5:return B=R.X,e.X.hasLoggedFirstStarted=!0,g.a(R,PBN(e),6);case 6:lSw({videoId:I,zc:e.X,offlineModeType:B},void 0,void 0,!0);R.Iq(3);break;case 7:B=R.X,
hs({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:I,zc:e.X,offlineModeType:B});case 3:return g.a(R,Qb9(e),8);case 8:return x=null,g.bn(R,9),g.a(R,dAh(e,L),11);case 11:x=R.X;e.B=x;g.DR(R,10);break;case 9:return S=g.wc(R),Bg("error getting player response",S,L.cotn),g.a(R,e.vG("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return R.return();case 10:return h=Kch(e.api.S(),L.cotn,x),g.a(R,l$e(e,h),13);case 13:return g.a(R,YAJ(h.videoId),
14);case 14:h.Fz=R.X,cSN(e.T,h,L.maximumDownloadQuality),e.G.start(108E5),g.AJ(R)}})},$AZ=function(e){var L,c;
return g.Z(function(I){if(I.K==1)return g.a(I,n9(e.K,"transfer"),2);L=I.X;c=L.filter(UAh).sort(E4L);return c.length===0?I.return():I.return(c[0])})},Qb9=function(e){var L,c,I;
return g.Z(function(B){if(B.K==1){if(!e.X)return Pg(e,"onTransferStart"),B.return();e.G.start(108E5);return g.a(B,Qx(e,"TRANSFER_STATE_TRANSFERRING"),2)}L=e.X;return(I=((c=L)==null?0:c.key)?g.QB(L.key).entityId:"")&&e.Z?g.a(B,qH(I,e.Z,e.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):B.Iq(0)})},eDL=function(e){var L,c,I,B;
g.Z(function(x){switch(x.K){case 1:if(!e.X){Pg(e,"onTransferPausedByUser");x.Iq(2);break}L=e.X;e.G.stop();return g.a(x,Qx(e,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:I=((c=L)==null?0:c.key)?g.QB(L.key).entityId:"";if(!I||!e.Z){x.Iq(4);break}return g.a(x,qH(I,e.Z,e.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.a(x,l4(e,I),6);case 6:B=x.X,Q$N({videoId:I,zc:L,offlineModeType:B});case 2:jV(e),Hg(e),g.AJ(x)}})},Lng=function(e){var L,c,I;
g.Z(function(B){if(B.K==1){if(!e.X)return Pg(e,"onTransferPausedByNetwork"),B.return();e.G.stop();return g.a(B,Qx(e,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(B.K!=3)return L=e.X,(I=((c=L)==null?0:c.key)?g.QB(L.key).entityId:"")&&e.Z?g.a(B,qH(I,e.Z,e.K,"DOWNLOAD_STATE_PAUSED"),3):B.Iq(3);jV(e);g.AJ(B)})},XTN=function(e){var L,c,I,B,x;
g.Z(function(S){switch(S.K){case 1:if(!e.X)return Pg(e,"onTransferComplete"),S.return();L=e.X;e.G.stop();if(!L||!e.B){S.Iq(2);break}c=Kch(e.api.S(),L.cotn,e.B);return g.a(S,l$e(e,c),2);case 2:return g.a(S,Qx(e,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:B=((I=L)==null?0:I.key)?g.QB(L.key).entityId:"";if(!B||!e.Z){S.Iq(5);break}return g.a(S,qH(B,e.Z,e.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.a(S,ySh(e.K,B),7);case 7:return g.a(S,l4(e,B),8);case 8:x=S.X,hs({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:B,zc:L,offlineModeType:x}),jV(e),Hg(e),g.AJ(S)}})},KnZ=function(e,L,c){var I,B;
g.Z(function(x){switch(x.K){case 1:if(!e.X)return Pg(e,"onTransferProgress: "+L),x.return();if(e.X.transferState==="TRANSFER_STATE_TRANSFERRING"){x.Iq(2);break}return g.a(x,Qb9(e),2);case 2:I=Date.now();if(!(I-e.Ve>1E3)){x.Iq(4);break}e.Ve=I;return g.a(x,mAN(e.K,c.videoId,c.K,c.Zh,c.bytesDownloaded,c.X),5);case 5:if(e.D&&!(e.D&&I-e.pS>e.He)){x.Iq(4);break}e.pS=I;return g.a(x,l4(e,L),7);case 7:B=x.X,lSw({videoId:L,zc:e.X,offlineModeType:B},c.bytesDownloaded,c.X);case 4:e.G.start(108E5),g.AJ(x)}})},
Y1e=function(e){var L=(e.X.transferRetryCount||0)<3;
L&&(e=e.X,e.transferRetryCount=(e.transferRetryCount||0)+1);return L},n4Z=function(e,L){L=L===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":L;
var c,I,B,x;return g.Z(function(S){if(S.K==1)return e.X||Pg(e,"setTransferToFailed: "+L),c="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L==="TRANSFER_FAILURE_REASON_NETWORK"?c="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":L==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(c="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.a(S,Qx(e,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",L),2);if(S.K!=3)return o4(e.h7,{entityKey:(I=e.X)==null?void 0:I.key,failureReason:c}),
B=e.X?g.QB(e.X.key).entityId:"",g.a(S,l4(e,B),3);x=S.X;var h={videoId:B,zc:e.X,offlineModeType:x},R=L,u={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};R&&(u.transferFailureReason=R,u.failureReason=dqZ(R));hs(u,h);g.AJ(S)})},Qx=function(e,L,c,I){var B;
return g.Z(function(x){if(x.K==1){if(!e.X)return Pg(e,"saveTransferState: "+L),x.return();e.X.transferState=L;e.X.failureReason=I;g.bn(x,2);return g.a(x,PBN(e,function(S){return c?l9(S,"offlineVideoStreams",e.X.offlineVideoStreams).then(function(h){for(var R=g.f(h),u=R.next();!u.done;u=R.next())if((u=u.value)&&u.streamsProgress){u=g.f(u.streamsProgress);for(var t=u.next();!t.done;t=u.next())t.value.streamState=c}return XkL(S,h.filter(function(O){return!!O}),"offlineVideoStreams")}):g.qO.resolve(void 0)}),
4)}if(x.K!=2)return g.DR(x,0);
B=g.wc(x);return B instanceof g.St&&B.type==="QUOTA_EXCEEDED"?g.a(x,e.vG("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):x.Iq(0)})},PBN=function(e,L){var c;
return g.Z(function(I){if(!e.X)return I.return();c=e.X;return g.a(I,XE(e.K,{mode:"readwrite",tK:!0},function(B){var x=[Qs(B,c,"transfer")];L&&x.push(L(B));return g.qO.all(x)}),0)})},jV=function(e){e.X=void 0;
e.B=void 0;e.G.stop()},dAh=function(e,L){var c,I,B,x,S;
return g.Z(function(h){if(h.K==1)return c=g.QB(L.key),I=c.entityId,B=g.dL(I,"playbackData"),g.a(h,YU(e.K,B,"playbackData"),2);x=h.X;if((S=x)==null?0:S.playerResponseJson)return h.return(JSON.parse(x.playerResponseJson));throw Error("No PlayerResponse found");})},Pg=function(e,L){e.api.sW("woffle",{mcte:L});
Bg("missing current transfer entity.")},l4=function(e,L){var c,I,B;
return g.Z(function(x){if(x.K==1)return g.a(x,YU(e.K,g.dL(L,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);c=x.X;return x.return((B=(I=c)==null?void 0:I.offlineModeType)!=null?B:void 0)})},UAh=function(e){return eQM[e.transferState]!==void 0},E4L=function(e,L){var c=eQM[e.transferState],I=eQM[L.transferState];
return c!==I?c-I:Number(e.enqueuedTimestampMs)-Number(L.enqueuedTimestampMs)},dn=function(e,L){var c=this;
this.XM=e;this.api=L;this.j=new g.af;this.B=new g.rk;this.kx={JF:function(){return c.Z.kx.JF()},
v9:function(){return c.j},
njY:function(){return c.Z},
Os:function(){return c.Os()},
HV:function(){return c.HV()},
Nb:function(){return c.Nb()},
z3:function(){return c.z3()},
xA:function(){return c.xA()},
ZX:function(I){return c.ZX(I)}};
this.Z=new yiZ(function(){return Lee(c)},function(){c.Nb()},this.api.cq(),this.api.Y.bind(this.api));
this.X=new xS(this.api);ZcM(this.Z)},Lee=function(e){return g.Z(function(L){e.api.fS("onOrchestrationBecameLeader");
return g.a(L,e.HV(),0)})},IWJ=function(e){var L,c;
return g.Z(function(I){if(I.K==1)return g.a(I,eV(),2);if(I.K!=3){L=I.X;if(!L)return Bg("PES is undefined"),I.return();e.K=new ZsM(L,e.api,e.Z,e.X);c=e.U8(L);return g.a(I,sbM(L,c,e.Z,e.X,e.XM),3)}e.T=I.X;return g.a(I,cLg(e),0)})},cLg=function(e){var L;
return g.Z(function(c){switch(c.K){case 1:if(!e.K)return Bg("transferManager is undefined"),c.return();if(e.K.X){c.Iq(2);break}return g.a(c,Hg(e.K),2);case 2:if(!e.XM.Y("woffle_enable_main_downloads_library")){c.Iq(4);break}return g.a(c,e.AN(),4);case 4:if(!e.XM.Y("html5_offline_playback_position_sync")){c.Iq(6);break}return g.a(c,e.UO(),7);case 7:return g.a(c,e.ZX(864E5),6);case 6:return g.a(c,e.refreshAllStaleEntities(43200,!0),9);case 9:return g.a(c,e.Ib(),10);case 10:if(!e.XM.Y("html5_retry_downloads_for_expiration")){c.Iq(11);
break}return g.a(c,e.xA(),11);case 11:return e.J=g.SG(function(){e.refreshAllStaleEntities(43200,!0);e.Ib()},9E5),g.HI(g.PI(),function(){return e.z3()}),g.a(c,eV(),13);
case 13:return L=c.X,g.a(c,mqN(L),14);case 14:pog(e.Z),g.AJ(c)}})},BpZ=function(){var e,L,c,I,B,x;
return g.Z(function(S){switch(S.K){case 1:return g.a(S,eV(),2);case 2:e=S.X;if(!e)return S.return([]);L=Date.now()/1E3;return g.a(S,n9(e,"offlineVideoPolicy"),3);case 3:c=S.X,I=g.f(c),B=I.next();case 4:if(B.done){S.Iq(6);break}x=B.value;if(!(x.expirationTimestamp&&Number(x.expirationTimestamp)<L)){S.Iq(5);break}x.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";x.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.a(S,K9(e,x,"offlineVideoPolicy"),5);
case 5:B=I.next();S.Iq(4);break;case 6:return S.return(c.map(function(h){return h.key}))}})},UM=function(e,L,c,I,B){var x,S,h;
return g.Z(function(R){if(R.K==1)return g.a(R,eV(),2);x=R.X;if(!x)return R.return([]);S=L.map(function(u){var t=g.dL(u,c);t={actionType:I,entityKey:t,actionMetadata:Object.assign({},Yae(),B)};I!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(t.actionMetadata.priority=0);u=new zt(c,u,t);return vg(u)});
h=xqw(x,S);ZcM(e.Z);return R.return(h)})},xZM=function(e,L,c,I){var B,x,S,h,R,u,t,O;
return g.Z(function(q){switch(q.K){case 1:B=[],x=g.f(L),S=x.next();case 2:if(S.done){q.Iq(4);break}h=S.value;if(h.upToDate||c&&!h.shouldAutoSyncMetadata||!h.playlistId){q.Iq(3);break}R={};switch(I){case "mainPlaylistEntity":u={nextAutoRefreshIntervalSeconds:h.checkInSeconds,autoSync:c};R={mainPlaylistEntityActionMetadata:u};break;case "musicPlaylist":t={autoSync:c},R={musicPlaylistEntityActionMetadata:t}}return g.a(q,UM(e,[h.playlistId],I,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",R),6);case 6:(O=
q.X)&&B.push.apply(B,g.V(O));case 3:S=x.next();q.Iq(2);break;case 4:return q.return(B)}})},o2M=function(e,L){var c;
return g.Z(function(I){return L.length?(c=Yae(),g.kg(c,NH,{isEnqueuedForExpiredStreamUrlRefetch:!0}),e.api.sW("qrd",{v:L.length}),I.return(UM(e,L,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c))):I.return([])})},Sme=function(e,L,c){this.X=e;
this.XM=L;this.Z=c},RQe=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w;
return g.Z(function(C){switch(C.K){case 1:return c=R4(L),I=g.QB(L.entityKey),B=I.entityId,x=[],g.bn(C,2),g.a(C,rL9(e,B),4);case 4:x=C.X;if(!(e.XM.Y("woffle_enable_main_downloads_library")&&((S=x)==null?0:S.length))){C.Iq(5);break}return g.a(C,u_Z(e.X,[L.entityKey]),5);case 5:g.DR(C,3);break;case 2:return h=g.wc(C),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.St&&h.type==="QUOTA_EXCEEDED"?(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Bg("Playlist add error"),C.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,R,u));case 3:t=[];if(!e.XM.Y("html5_offline_prevent_redownload_downloaded_video")){C.Iq(7);break}return g.a(C,XoL(e.X,"mainVideoEntity",x),8);case 8:x=C.X;case 7:if((O=x)==null?0:O.length)for(q=g.f(x),T=q.next();!T.done;T=q.next())if(W=T.value,A=W.offlineVideoData,b=void 0,(b=A)==null?0:b.videoId)J=void 0,w=Number(((J=L.actionMetadata)==null?void 0:J.priority)||
0)+1,t.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A.videoId,"mainVideoEntity",w,EM,hQ7(L,A,B)));return C.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,t))}})},tZe=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ,Mg,QM,Is,D,Zt,CZ,IH,wM,F,L6,Qc,S5,je,dc,ee,ne,pe,G,v,k,N,H,O$,d,Y,m,aH,PM,hJ,tw,Vr,Fx,ef,GL,ZJ,kn,Aj,C6,aL,gM;
return g.Z(function(h_){switch(h_.K){case 1:return c=R4(L),I=L.entityKey,B=g.QB(I).entityId,x=[],S=!1,B==="!*$_ALL_ENTITIES_!*$"?(S=!0,g.a(h_,n9(e.X,"mainPlaylistEntity"),5)):g.a(h_,YU(e.X,I,"mainPlaylistEntity"),4);case 4:(h=h_.X)&&x.push(h);h_.Iq(3);break;case 5:x=h_.X;case 3:if((R=x)==null||!R.length)return h_.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));u=g.Q(L.actionMetadata,uZL);O=(t=u)==null?void 0:t.nextAutoRefreshIntervalSeconds;T=(q=u)==null?void 0:q.autoSync;W=[];b=A=
!0;J=!1;if(!S&&T===!1){h_.Iq(6);break}g.bn(h_,7);return g.a(h_,iaM(0,!!T,!0,x),9);case 9:W=h_.X;g.DR(h_,8);break;case 7:w=g.wc(h_);if(!(w instanceof Error&&w.message==="No data")){w instanceof Error&&w.message==="Empty response body"&&Bg(w.message);h_.Iq(8);break}return B==="!*$_ALL_ENTITIES_!*$"?g.a(h_,xkZ(e.X,L,e.Z,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.a(h_,IXJ(B,e.X,L,e.Z),8);case 8:if(!W.length||!S&&W[0].playlistId!==B)return h_.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));case 6:if(S){C=[];y=g.f(W);for(P=y.next();!P.done;P=y.next())ev=P.value,ev.upToDate||T&&!ev.shouldAutoSyncMetadata||!ev.playlistId||(X={nextAutoRefreshIntervalSeconds:ev.checkInSeconds,autoSync:T},C.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ev.playlistId,"mainPlaylistEntity",0,EM,{mainPlaylistEntityActionMetadata:X})));return h_.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,C))}W.length&&(oH=W[0],J=!!oH.upToDate,T&&(A=(rc=oH.shouldAutoSyncMetadata)!=null?rc:!0,b=(Sv=
oH.shouldAutoSyncVideos)!=null?Sv:!0,oH.checkInSeconds&&(O=oH.checkInSeconds)));if(J||!A)return h_.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));tJ=[];cM=x[0];if(!cM.downloadState){JJ=void 0;h_.Iq(15);break}return g.a(h_,YU(e.X,cM.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:JJ=h_.X;case 15:return yr=JJ,$N=((cU=yr)==null?0:cU.addedTimestampMillis)?String(yr.addedTimestampMillis):void 0,g.bn(h_,17),g.a(h_,rL9(e,B,$N,O),19);case 19:tJ=h_.X;g.DR(h_,18);break;case 17:fZ=
g.wc(h_);if(!(fZ instanceof Error&&fZ.message==="No data for playlist")){if(fZ instanceof Error&&fZ.message==="Empty response body for playlist")Bg(fZ.message);else return $n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",nZ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",fZ instanceof g.St&&fZ.type==="QUOTA_EXCEEDED"&&($n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",nZ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h_.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
c,void 0,$n,nZ));h_.Iq(18);break}return g.a(h_,IXJ(B,e.X,L,e.Z),18);case 18:if(!b)return h_.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));Mg=[];QM=new Map;if((Is=tJ)==null?0:Is.length)for(D=g.f(tJ),Zt=D.next();!Zt.done;Zt=D.next())CZ=Zt.value,IH=CZ.offlineVideoData,wM=void 0,((wM=IH)==null?0:wM.videoId)&&QM.set(IH.videoId,IH);F=new Map;L6=[];if((Qc=cM)==null?0:(S5=Qc.videos)==null?0:S5.length)for(je=g.f(cM.videos),dc=je.next();!dc.done;dc=je.next())if(ee=dc.value,ne=JSON.parse(g.QB(ee).entityId),
pe=ne.videoId)QM.has(pe)?(F.set(pe,QM.get(pe)),QM.delete(pe)):L6.push(pe);v=Number(((G=L.actionMetadata)==null?void 0:G.priority)||0)+1;k=g.f(QM.entries());for(N=k.next();!N.done;N=k.next())H=N.value,O$=g.f(H),d=O$.next().value,Y=O$.next().value,m=d,aH=Y,Mg.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m,"mainVideoEntity",v,EM,hQ7(L,aH,B)));PM=g.f(F.entries());for(hJ=PM.next();!hJ.done;hJ=PM.next())tw=hJ.value,Vr=g.f(tw),Fx=Vr.next().value,ef=Vr.next().value,GL=Fx,ZJ=ef,Mg.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
GL,"mainVideoEntity",v,EM,hQ7(L,ZJ,B)));kn=g.f(L6);for(Aj=kn.next();!Aj.done;Aj=kn.next())C6=Aj.value,aL={playlistId:B},gM={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:aL},Mg.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",C6,"mainVideoEntity",0,EM,gM));return h_.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Mg))}})},O1w=function(e,L){var c,I,B,x;
return g.Z(function(S){switch(S.K){case 1:return c=R4(L),g.bn(S,2),I=g.QB(L.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.a(S,xkZ(e.X,L,e.Z,(B=L.actionMetadata)==null?void 0:(x=B.offlineLoggingData)==null?void 0:x.offlineDeleteReason),5):g.a(S,IXJ(I,e.X,L,e.Z),6);case 6:if(!e.XM.Y("woffle_enable_main_downloads_library")){S.Iq(5);break}return g.a(S,t1e(e.X,L.entityKey),5);case 5:g.DR(S,3);break;case 2:return g.wc(S),S.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return S.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},rL9=function(e,L,c,I){var B,x,S,h,R,u,t;
return g.Z(function(O){switch(O.K){case 1:return g.a(O,Fae([L]),2);case 2:return B=O.X,g.a(O,qmM(e,B[0],c,I),3);case 3:return x=O.X,S=x.mainPlaylistEntity,h=x.o07,u=La7(S,(R=h)==null?void 0:R.avatar),g.bn(O,4),g.a(O,As(u),6);case 6:g.DR(O,5);break;case 4:t=g.wc(O),t instanceof Error&&t.message==="Failed to fetch"&&Bg(t.message);case 5:return O.return(B[0].videos)}})},qmM=function(e,L,c,I){var B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y;
return g.Z(function(P){switch(P.K){case 1:B=Date.now().toString();c||(c=B);x=L.videos;S=L.playlistId;h=[];R=[];if(x)for(u=g.f(x),t=u.next();!t.done;t=u.next()){O=t.value;q=O.offlineVideoData;if(!q||!q.videoId)throw Bg("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");T=q.videoId;W={videoId:T,playlistId:S};A={id:g.dL(JSON.stringify(W),"mainPlaylistVideoEntity"),video:g.dL(T,"mainVideoEntity")};h.push(A);R.push(A.id)}J={key:g.dL(S,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:c,lastSyncedTimestampMillis:B};w={key:g.dL(S,"mainPlaylistEntity"),playlistId:S,videos:R,title:L.title,thumbnailStyleData:TpL(L),visibility:WeJ(L),downloadState:J.key};L.channel&&(C=L.channel.offlineChannelData,b=MZJ(g.dL(S,"ytMainChannelEntity"),C),w.channelOwner=b.id);((y=w)==null?0:y.entityMetadata)?(w.entityMetadata.offlineLastModifiedTimestampSeconds=L.lastModifiedTimestamp,I&&(w.entityMetadata.nextAutoRefreshIntervalSeconds=String(I))):w&&(w.entityMetadata={nextAutoRefreshIntervalSeconds:I?
String(I):void 0,offlineLastModifiedTimestampSeconds:L.lastModifiedTimestamp});g.bn(P,2);return g.a(P,XE(e.X,{mode:"readwrite",tK:!0},function(ev){var X=Qs(ev,w,"mainPlaylistEntity"),oH=Qs(ev,J,"mainPlaylistDownloadStateEntity");X=[X,oH];oH=g.f(h);for(var rc=oH.next();!rc.done;rc=oH.next())X.push(Qs(ev,rc.value,"mainPlaylistVideoEntity"));b&&X.push(Qs(ev,b,"ytMainChannelEntity"));return g.qO.all(X)}),4);
case 4:g.DR(P,3);break;case 2:throw g.wc(P),Bg("PES failure for playlist"),Error("PES failure for playlist");case 3:return P.return({mainPlaylistEntity:w,o07:b,Izm:h})}})},MZJ=function(e,L){return{id:e,
channelId:L.channelId,title:L.title,avatar:L.thumbnail}},TpL=function(e){var L=[],c=e.videos;
c&&c.length>0&&L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:c[0].offlineVideoData.thumbnail}}});if((e=e.additionalMetadadatas)&&e.length>0)for(e=g.f(e),c=e.next();!c.done;c=e.next()){var I=c.value.offlineBundleItemPlaylistData,B=void 0;c=(B=I)==null?void 0:B.style;B=void 0;I={collageThumbnail:{coverThumbnail:(B=I)==null?void 0:B.coverThumbnail}};switch(c){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:I});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:I});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:I});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":L.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:I})}}return L},WeJ=function(e){switch(e.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},hQ7=function(e,L,c){L={offlineVideoData:L,
playlistId:c};if(e=g.Q(e.actionMetadata,uZL))L.maximumDownloadQuality=e.maximumDownloadQuality;return{mainVideoEntityActionMetadata:L}},zQN=function(e,L,c){this.X=e;
this.XM=L;this.Z=c},fWe=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W;
return g.Z(function(A){switch(A.K){case 1:return c=R4(L),I=g.QB(L.entityKey),B=I.entityId,x=g.Q(L.actionMetadata,Xf),h=!((S=x)==null?0:S.playlistId),g.bn(A,2),g.a(A,sAJ(e,B,void 0,(R=x)==null?void 0:R.offlineVideoData,h),4);case 4:g.DR(A,3);break;case 2:return u=g.wc(A),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.St&&u.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,t,O));case 3:q=1;q=Number(((T=L.actionMetadata)==null?void 0:T.priority)||0)+1;var b=(b=g.Q(L.actionMetadata,Xf))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;W=Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B,"playbackData",q,v2L,b);return A.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,[W]))}})},ALL=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w;
return g.Z(function(C){switch(C.K){case 1:return c=R4(L),I=g.QB(L.entityKey),B=I.entityId,g.a(C,YU(e.X,L.entityKey,"mainVideoEntity"),2);case 2:x=C.X;if(!x){S=void 0;C.Iq(3);break}return g.a(C,YU(e.X,x.downloadState,"mainVideoDownloadStateEntity"),4);case 4:S=C.X;case 3:h=S;if(!x||!h)return C.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));g.bn(C,5);return g.a(C,sAJ(e,B,h.addedTimestampMillis,(u=g.Q(L.actionMetadata,Xf))==null?void 0:u.offlineVideoData),7);case 7:t=1;t=Number(((O=
L.actionMetadata)==null?void 0:O.priority)||0)+1;R=Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B,"playbackData",t,v2L);g.DR(C,6);break;case 5:q=g.wc(C);if(!(q instanceof Error&&q.message==="No data")){if(q instanceof Error&&q.message==="Empty response body")Bg(q.message);else return T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.St&&q.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,T,W));C.Iq(6);break}return g.a(C,i4(e.X,B),9);case 9:A=C.X;b=g.Q(L.actionMetadata,Xf);if(w=(J=b)==null?void 0:J.playlistId)A.playlistId=w;A.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.a(C,Ff(B,e.X,L,e.Z,A),6);case 6:return C.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,R?[R]:void 0))}})},Fe7=function(e,L){var c,I,B,x,S,h,R,u,t,O;
return g.Z(function(q){switch(q.K){case 1:return c=R4(L),g.bn(q,2),I=g.QB(L.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.a(q,xkZ(e.X,L,e.Z,(t=L.actionMetadata)==null?void 0:(O=t.offlineLoggingData)==null?void 0:O.offlineDeleteReason),5):g.a(q,i4(e.X,I),6);case 6:B=q.X;x=g.Q(L.actionMetadata,Xf);if(h=(S=x)==null?void 0:S.playlistId)B.playlistId=h;B.offlineDeleteReason=(R=L.actionMetadata)==null?void 0:(u=R.offlineLoggingData)==null?void 0:u.offlineDeleteReason;return g.a(q,Ff(I,e.X,L,e.Z,B),7);
case 7:if(!e.XM.Y("woffle_enable_main_downloads_library")){q.Iq(5);break}return g.a(q,t1e(e.X,L.entityKey),5);case 5:g.DR(q,3);break;case 2:return g.wc(q),q.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c))}})},sAJ=function(e,L,c,I,B){var x,S,h,R,u,t;
return g.Z(function(O){switch(O.K){case 1:if(x=I){O.Iq(2);break}return g.a(O,AUN([L]),3);case 3:S=O.X,x=S[0];case 2:return g.a(O,b1L(e,x,c,B),4);case 4:h=O.X;R=h.mainVideoEntity;u=h.channelEntity;g.bn(O,5);var q=MH(R.thumbnail),T=MH(u.avatar);return g.a(O,As(q.concat(T)),7);case 7:g.DR(O,0);break;case 5:t=g.wc(O),t instanceof Error&&t.message==="Failed to fetch"&&Bg(t.message),g.AJ(O)}})},b1L=function(e,L,c,I){var B,x,S,h,R,u,t,O,q,T,W,A,b;
return g.Z(function(J){switch(J.K){case 1:c||(c=Date.now().toString());x=(B=L.channel)==null?void 0:B.offlineChannelData;S={id:g.dL(L.videoId,"ytMainChannelEntity"),channelId:x.channelId,title:x.title,avatar:x.thumbnail};h={key:g.dL(L.videoId,"mainVideoDownloadStateEntity"),playbackData:g.dL(L.videoId,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.dL(L.videoId,"videoDownloadContextEntity")};R={key:g.dL(L.videoId,"videoPlaybackPositionEntity"),videoId:L.videoId,lastPlaybackPositionSeconds:"0"};
e.XM.Y("html5_offline_playback_position_sync")&&(u={playbackPosition:R.key});t=g.dL(L.videoId,"mainVideoEntity");O={key:t,videoId:L.videoId,title:L.title,thumbnail:L.thumbnail,localizedStrings:{viewCount:L.shortViewCountText},userState:u,lengthSeconds:L.lengthSeconds?Number(L.lengthSeconds):void 0,publishedTimestampMillis:L.publishedTimestamp?(Number(L.publishedTimestamp)*1E3).toString():void 0,formattedDescription:L.description,owner:S.id,downloadState:h.key};if(!e.XM.Y("woffle_enable_main_downloads_library")||
!I){J.Iq(2);break}return g.a(J,RLZ(e.X,[t]),3);case 3:if(W=J.X)q=W.mainDownloadsLibraryEntity,T=W.mainDownloadsListEntity;case 2:return b=EAL,A={key:g.dL(L.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.kg(h,b,A),g.a(J,XE(e.X,{mode:"readwrite",tK:!0},function(w){var C=Qs(w,S,"ytMainChannelEntity"),y=Qs(w,h,"mainVideoDownloadStateEntity"),P=Qs(w,O,"mainVideoEntity");C=[C,y,P];e.XM.Y("html5_offline_playback_position_sync")&&(y=Qs(w,R,"videoPlaybackPositionEntity"),
C.push(y));q&&(y=Qs(w,q,"mainDownloadsLibraryEntity"),C.push(y));T&&(y=Qs(w,T,"mainDownloadsListEntity"),C.push(y));A&&(w=Qs(w,A,"downloadStatusEntity"),C.push(w));return g.qO.all(C)}),4);
case 4:return J.return({mainVideoEntity:O,channelEntity:S})}})},i1w=function(e,L,c){this.X=e;
this.XM=L;this.Z=c},g2M=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM;
return g.Z(function(JJ){switch(JJ.K){case 1:return c=R4(L),I=[],g.a(JJ,p9.getInstance(),2);case 2:B=JJ.X;if(!B){JJ.Iq(3);break}return g.a(JJ,B.get("sdois"),4);case 4:return x=JJ.X,g.a(JJ,(h=B)==null?void 0:h.get("lmqf"),5);case 5:S=JJ.X;case 3:g.bn(JJ,6);if(x===void 0)throw Error("prefStorage or opt-in state is undefined");R=[];if(x){JJ.Iq(8);break}return g.a(JJ,hLU(e.X),9);case 9:R=JJ.X,R.reverse();case 8:if(!R.length){JJ.Iq(10);break}u=g.f(R);t=u.next();case 11:if(t.done){JJ.Iq(10);break}O=t.value;
if(!O){JJ.Iq(12);break}q=g.QB(O).entityId;return g.a(JJ,i4(e.X,q),14);case 14:return T=JJ.X,T.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.a(JJ,Ff(q,e.X,{entityKey:O,actionType:L.actionType},e.Z,T),12);case 12:t=u.next();JJ.Iq(11);break;case 10:return g.a(JJ,gdZ(x,(W=S)!=null?W:"SD"),16);case 16:return A=JJ.X,g.a(JJ,odU(A),17);case 17:b=rU7(A);if(!e.XM.Y("woffle_enable_main_downloads_library")){JJ.Iq(18);break}if(x){JJ.Iq(19);break}return g.a(JJ,t1e(e.X,g.Hj),19);case 19:return g.a(JJ,
u_Z(e.X,[g.Hj]),18);case 18:if((J=b)==null?0:J.length)for(w=g.f(b),C=w.next();!C.done;C=w.next())if(P=y=C.value,ev=P.actionType,X=P.entityKey,oH=P.actionMetadata,ev&&X&&oH&&!g.Q(oH,GlZ)){ev==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(oH.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(rc=g.Q(y.actionMetadata,Xf))rc.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",y.actionMetadata=Object.assign({},y.actionMetadata,{mainVideoEntityActionMetadata:rc});I.push(y)}g.DR(JJ,
7);break;case 6:return Sv=g.wc(JJ),tJ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",cM="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Sv instanceof g.St&&Sv.type==="QUOTA_EXCEEDED"&&(tJ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",cM="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),JJ.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,tJ,cM));case 7:return JJ.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,I))}})},klL=function(){dn.apply(this,
arguments);
this.D="mainVideoEntity"},DZL=function(e,L,c){L=L===void 0?43200:L;
c=c===void 0?!0:c;var I=I===void 0?!1:I;var B,x,S;return g.Z(function(h){switch(h.K){case 1:if(!e.j.y9())return h.return([]);B=[];g.bn(h,2);return g.a(h,iaM(L,c,I),4);case 4:B=h.X;g.DR(h,3);break;case 2:x=g.wc(h),x instanceof Error&&x.message==="No data"||x instanceof Error&&x.message==="Empty response body"&&Bg(x.message);case 3:return S=xZM(e,B,c,"mainPlaylistEntity"),h.return(S)}})},wYU=function(e,L,c,I){I=I===void 0?!1:I;
var B,x,S,h,R,u,t,O,q,T,W,A,b,J,w;return g.Z(function(C){switch(C.K){case 1:return B=[],g.a(C,Gae(),2);case 2:return(x=C.X)||I?g.a(C,kaw(L,c),3):C.return([]);case 3:S=C.X;if((h=S)==null||!h.length)return C.return([]);R={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};u=g.f(S);t=u.next();case 4:if(t.done){C.Iq(6);break}q=O=t.value;T=q.actionType;W=q.entityKey;A=q.actionMetadata;if(!(T&&W&&A)||g.Q(A,GlZ)){C.Iq(5);break}T==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(A.offlineLoggingData=
R);b=g.QB(W);J=b.entityId;return g.a(C,UM(e,[J],"mainVideoEntity",T,A),8);case 8:w=C.X,B=B.concat(w);case 5:t=u.next();C.Iq(4);break;case 6:return C.return(B)}})},JL9=function(e,L){this.X=e;
this.Z=L},CAL=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J;
return g.Z(function(w){switch(w.K){case 1:return c=R4(L),I=g.QB(L.entityKey),B=I.entityId,x=[],g.bn(w,2),g.a(w,VZw(e,B),4);case 4:x=w.X;if((S=x)==null||!S.length){w.Iq(5);break}return g.a(w,M1L(e.X,L.entityKey),5);case 5:g.DR(w,3);break;case 2:return h=g.wc(w),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.St&&h.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,R,u));case 3:return t=[],g.a(w,XoL(e.X,"musicTrack",x),7);case 7:x=w.X;if(x.length)for(O=g.f(x),q=O.next();!q.done;q=O.next())if(T=q.value,W=T.offlineVideoData,A=void 0,(A=W)==null?0:A.videoId)b=void 0,J=Number(((b=L.actionMetadata)==null?void 0:b.priority)||0)+1,t.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",J,Kd,Dg(L,W,B)));return w.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,t))}})},
aWM=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ,Mg,QM,Is,D,Zt,CZ,IH,wM,F,L6,Qc,S5,je,dc,ee,ne,pe,G,v,k,N,H,O$,d,Y;
return g.Z(function(m){switch(m.K){case 1:return c=R4(L),I=L.entityKey,B=g.QB(I).entityId,x=[],S=!1,B==="!*$_ALL_ENTITIES_!*$"?(S=!0,g.a(m,n9(e.X,"musicAlbumRelease"),5)):g.a(m,YU(e.X,I,"musicAlbumRelease"),4);case 4:(h=m.X)&&x.push(h);m.Iq(3);break;case 5:x=m.X;case 3:if((R=x)==null||!R.length)return m.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));if(S){u=[];t=g.f(x);for(O=t.next();!O.done;O=t.next())q=O.value,T=g.QB(q.id).entityId,u.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
T,"musicAlbumRelease",0,Kd));return m.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,u))}W=[];A=x[0];b=void 0;if(!A.downloadMetadata){m.Iq(6);break}return g.a(m,YU(e.X,A.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:J=m.X,b=Number((C=(w=J)==null?void 0:w.addedTimestampMillis)!=null?C:"0")/1E3;case 6:return g.bn(m,8),g.a(m,VZw(e,B,(y=b)==null?void 0:y.toString()),10);case 10:W=m.X;g.DR(m,9);break;case 8:P=g.wc(m);if(!(P instanceof Error&&P.message==="No data")){if(P instanceof
Error&&P.message==="Empty response body")Bg(P.message);else return ev="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.St&&P.type==="QUOTA_EXCEEDED"&&(ev="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,ev,X));m.Iq(9);break}return g.a(m,gn(B,"musicAlbumRelease",e.X,L,e.Z),9);case 9:oH=[];rc=
new Map;if((Sv=W)==null?0:Sv.length)for(tJ=g.f(W),cM=tJ.next();!cM.done;cM=tJ.next())JJ=cM.value,yr=JJ.offlineVideoData,cU=void 0,((cU=yr)==null?0:cU.videoId)&&rc.set(yr.videoId,yr);$N=new Map;fZ=[];if(($n=A)==null?0:(nZ=$n.tracks)==null?0:nZ.length)for(Mg=g.f(A.tracks),QM=Mg.next();!QM.done;QM=Mg.next())if(Is=QM.value,D=g.QB(Is).entityId)rc.has(D)?($N.set(D,rc.get(D)),rc.delete(D)):fZ.push(D);CZ=Number(((Zt=L.actionMetadata)==null?void 0:Zt.priority)||0)+1;IH=g.f(rc.entries());for(wM=IH.next();!wM.done;wM=
IH.next())F=wM.value,L6=g.f(F),Qc=L6.next().value,S5=L6.next().value,je=Qc,dc=S5,oH.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",je,"musicTrack",CZ,Kd,Dg(L,dc)));ee=g.f($N.entries());for(ne=ee.next();!ne.done;ne=ee.next())pe=ne.value,G=g.f(pe),v=G.next().value,k=G.next().value,N=v,H=k,oH.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N,"musicTrack",CZ,Kd,Dg(L,H)));O$=g.f(fZ);for(d=O$.next();!d.done;d=O$.next())Y=d.value,oH.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Y,"musicTrack",
0,Kd));return m.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,oH))}})},NpM=function(e,L){var c,I;
return g.Z(function(B){switch(B.K){case 1:return c=R4(L),g.bn(B,2),I=g.QB(L.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.a(B,kS(e.X,L,e.Z),5):g.a(B,gn(I,"musicAlbumRelease",e.X,L,e.Z),6);case 6:return g.a(B,zLU(e.X,L.entityKey),5);case 5:g.DR(B,3);break;case 2:return g.wc(B),B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},VZw=function(e,L,c){var I,B,x;
return g.Z(function(S){switch(S.K){case 1:return g.a(S,Fae([L]),2);case 2:return I=S.X,g.a(S,mZL(e,I[0],c),3);case 3:return B=S.X,x=MH(B.thumbnailDetails),g.a(S,As(x),4);case 4:return S.return(I[0].videos)}})},mZL=function(e,L,c){var I,B,x,S,h,R,u,t,O,q,T,W,A,b;
return g.Z(function(J){if(J.K==1){I=L.additionalMetadadatas;B=void 0;if(I&&I.length>0)for(x=g.f(I),S=x.next();!S.done;S=x.next())if(h=S.value,h.offlineMusicPlaylistData){B=h.offlineMusicPlaylistData;break}R=L.playlistId;u=sdw(L);t=u.mT;O=u.HE;q=c?(Number(c)*1E3).toString():Date.now().toString();T=L.lastModifiedTimestamp?(Number(L.lastModifiedTimestamp)*1E3).toString():"0";W={id:g.dL(R,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:O,lastModifiedTimestampMillis:T,addedTimestampMillis:q,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};A={id:g.dL(R,"musicAlbumRelease"),title:L.title,audioPlaylistId:R,trackCount:L.totalVideoCount,tracks:t,downloadMetadata:W.id};B&&(A.thumbnailDetails=(b=B.albumHqThumbnail)!=null?b:B.albumArtistThumbnail,A.artistDisplayName=B.albumArtistDisplayName,A.releaseDate=B.albumReleaseDate,A.contentRating={explicitType:B.albumReleaseExplicitType},A.releaseType=B.albumReleaseType);return g.a(J,XE(e.X,{mode:"readwrite",tK:!0},function(w){var C=Qs(w,A,"musicAlbumRelease");
w=Qs(w,W,"musicAlbumReleaseDownloadMetadataEntity");return g.qO.all([C,w])}),2)}return J.return(A)})},yLJ=function(e,L){this.X=e;
this.Z=L},pYU=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J;
return g.Z(function(w){switch(w.K){case 1:return c=R4(L),I=g.QB(L.entityKey),B=I.entityId,x=[],g.bn(w,2),g.a(w,Z1M(e,B),4);case 4:x=w.X;if((S=x)==null||!S.length){w.Iq(5);break}return g.a(w,M1L(e.X,L.entityKey),5);case 5:g.DR(w,3);break;case 2:return h=g.wc(w),R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.St&&h.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,R,u));case 3:return t=[],g.a(w,XoL(e.X,"musicTrack",x),7);case 7:x=w.X;if(x.length)for(O=g.f(x),q=O.next();!q.done;q=O.next())if(T=q.value,W=T.offlineVideoData,A=void 0,(A=W)==null?0:A.videoId)b=void 0,J=Number(((b=L.actionMetadata)==null?void 0:b.priority)||0)+1,t.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",J,YS,Dg(L,W,B)));return w.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,t))}})},
$Ze=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ,Mg,QM,Is,D,Zt,CZ,IH,wM,F,L6,Qc,S5,je,dc,ee,ne,pe,G,v,k,N,H,O$,d,Y,m,aH,PM,hJ,tw,Vr,Fx,ef,GL,ZJ,kn,Aj;
return g.Z(function(C6){switch(C6.K){case 1:return c=R4(L),I=L.entityKey,B=g.QB(I).entityId,x=[],S=!1,B==="!*$_ALL_ENTITIES_!*$"?(S=!0,g.a(C6,n9(e.X,"musicPlaylist"),5)):g.a(C6,YU(e.X,I,"musicPlaylist"),4);case 4:(h=C6.X)&&x.push(h);C6.Iq(3);break;case 5:x=C6.X;case 3:if((R=x)==null||!R.length)return C6.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));u=g.Q(L.actionMetadata,vdL);O=(t=u)==null?void 0:t.autoSync;q=[];W=T=!0;A=!1;b=void 0;if(!S&&O===!1){C6.Iq(6);break}g.bn(C6,7);return g.a(C6,
DkU(0,!!O,!0,x),9);case 9:q=C6.X;g.DR(C6,8);break;case 7:J=g.wc(C6);if(!(J instanceof Error&&J.message==="No data")){J instanceof Error&&J.message==="Empty response body"&&Bg(J.message);C6.Iq(8);break}return B==="!*$_ALL_ENTITIES_!*$"?g.a(C6,kS(e.X,L,e.Z),8):g.a(C6,gn(B,"musicPlaylist",e.X,L,e.Z),8);case 8:if(!q.length||!S&&q[0].playlistId!==B)return C6.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));case 6:if(S){w=[];C=g.f(q);for(y=C.next();!y.done;y=C.next())P=y.value,P.upToDate||
O&&!P.shouldAutoSyncMetadata||!P.playlistId||(ev={autoSync:O},w.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P.playlistId,"musicPlaylist",0,YS,{musicPlaylistEntityActionMetadata:ev})));return C6.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,w))}q.length&&(X=q[0],A=!!X.upToDate,O&&(T=(oH=X.shouldAutoSyncMetadata)!=null?oH:!0,W=(rc=X.shouldAutoSyncVideos)!=null?rc:!0,X.checkInSeconds&&(b=X.checkInSeconds)));if(A||!T)return C6.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));Sv=[];tJ=x[0];cM=void 0;if(!tJ.downloadMetadata){C6.Iq(15);break}return g.a(C6,YU(e.X,tJ.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:JJ=C6.X,cM=Number((cU=(yr=JJ)==null?void 0:yr.addedTimestampMillis)!=null?cU:"0")/1E3;case 15:return g.bn(C6,17),g.a(C6,Z1M(e,B,($N=cM)==null?void 0:$N.toString(),b),19);case 19:Sv=C6.X;g.DR(C6,18);break;case 17:fZ=g.wc(C6);if(!(fZ instanceof Error&&fZ.message==="No data")){if(fZ instanceof Error&&fZ.message==="Empty response body")Bg(fZ.message);
else return $n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",nZ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",fZ instanceof g.St&&fZ.type==="QUOTA_EXCEEDED"&&($n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",nZ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C6.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,$n,nZ));C6.Iq(18);break}return g.a(C6,gn(B,"musicPlaylist",e.X,L,e.Z),18);case 18:if(!W)return C6.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c));Mg=[];QM=new Map;if((Is=Sv)==null?0:Is.length)for(D=g.f(Sv),Zt=D.next();!Zt.done;Zt=D.next())CZ=Zt.value,IH=CZ.offlineVideoData,wM=void 0,((wM=IH)==null?0:wM.videoId)&&QM.set(IH.videoId,IH);F=new Map;L6=[];if((Qc=tJ)==null?0:(S5=Qc.tracks)==null?0:S5.length)for(je=g.f(tJ.tracks),dc=je.next();!dc.done;dc=je.next())if(ee=dc.value,ne=g.QB(ee).entityId)QM.has(ne)?(F.set(ne,QM.get(ne)),QM.delete(ne)):L6.push(ne);G=Number(((pe=L.actionMetadata)==null?void 0:pe.priority)||0)+1;v=g.f(QM.entries());for(k=
v.next();!k.done;k=v.next())N=k.value,H=g.f(N),O$=H.next().value,d=H.next().value,Y=O$,m=d,Mg.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y,"musicTrack",G,YS,Dg(L,m)));aH=g.f(F.entries());for(PM=aH.next();!PM.done;PM=aH.next())hJ=PM.value,tw=g.f(hJ),Vr=tw.next().value,Fx=tw.next().value,ef=Vr,GL=Fx,Mg.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ef,"musicTrack",G,YS,Dg(L,GL)));ZJ=g.f(L6);for(kn=ZJ.next();!kn.done;kn=ZJ.next())Aj=kn.value,Mg.push(Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Aj,"musicTrack",0,YS));return C6.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,Mg))}})},jAN=function(e,L){var c,I;
return g.Z(function(B){switch(B.K){case 1:return c=R4(L),g.bn(B,2),I=g.QB(L.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.a(B,kS(e.X,L,e.Z),5):g.a(B,gn(I,"musicPlaylist",e.X,L,e.Z),6);case 6:return g.a(B,zLU(e.X,L.entityKey),5);case 5:g.DR(B,3);break;case 2:return g.wc(B),B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},Z1M=function(e,L,c,I){var B,x,S;
return g.Z(function(h){switch(h.K){case 1:return g.a(h,Fae([L]),2);case 2:return B=h.X,g.a(h,H1L(e,B[0],c,I),3);case 3:return x=h.X,S=MH(x.thumbnailDetails),g.a(h,As(S),4);case 4:return h.return(B[0].videos)}})},H1L=function(e,L,c,I){var B,x,S,h,R,u,t,O,q;
return g.Z(function(T){return T.K==1?(B=L.playlistId,x=sdw(L),S=x.mT,h=x.HE,R=c?(Number(c)*1E3).toString():Date.now().toString(),u=L.lastModifiedTimestamp?(Number(L.lastModifiedTimestamp)*1E3).toString():"0",t={id:g.dL(B,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:h,lastModifiedTimestampMillis:u,addedTimestampMillis:R,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},O={id:g.dL(B,"musicPlaylist"),title:L.title,playlistId:B,thumbnailDetails:L.thumbnail,visibility:lWZ(L),trackCount:L.totalVideoCount,
tracks:S,downloadMetadata:t.id},I&&(((q=O)==null?0:q.entityMetadata)?O.entityMetadata.nextAutoRefreshIntervalSeconds=String(I):O&&(O.entityMetadata={nextAutoRefreshIntervalSeconds:String(I)})),g.a(T,XE(e.X,{mode:"readwrite",tK:!0},function(W){var A=Qs(W,O,"musicPlaylist");W=Qs(W,t,"musicPlaylistDownloadMetadataEntity");return g.qO.all([A,W])}),2)):T.return(O)})},lWZ=function(e){switch(e.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},PAe=function(e,L){this.X=e;
this.Z=L},E2e=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W;
return g.Z(function(A){switch(A.K){case 1:return c=R4(L),I=g.QB(L.entityKey),B=I.entityId,x=g.Q(L.actionMetadata,QAe),g.bn(A,2),g.a(A,dZJ(e,B,void 0,(S=x)==null?void 0:S.track,(h=x)==null?void 0:h.albumRelease),4);case 4:if((R=x)==null?0:R.playlistId){A.Iq(5);break}return g.a(A,M1L(e.X,L.entityKey),5);case 5:g.DR(A,3);break;case 2:return u=g.wc(A),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.St&&u.type==="QUOTA_EXCEEDED"&&
(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,t,O));case 3:T=Number(((q=L.actionMetadata)==null?void 0:q.priority)||0)+1;var b=(b=g.Q(L.actionMetadata,QAe))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;W=Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B,"playbackData",T,UZL,b);return A.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c,[W]))}})},XYh=function(e,L){var c,I,B,x,S,h,R,u,t,O,q,T,W,A,b;
return g.Z(function(J){switch(J.K){case 1:return c=R4(L),I=g.QB(L.entityKey),B=I.entityId,g.a(J,YU(e.X,L.entityKey,"musicTrack"),2);case 2:x=J.X;if(!x){S=void 0;J.Iq(3);break}return g.a(J,YU(e.X,x.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:S=J.X;case 3:h=S;if(!x||!h)return J.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c));u=g.Q(L.actionMetadata,QAe);g.bn(J,5);return g.a(J,dZJ(e,B,h.addedTimestampMillis,(t=u)==null?void 0:t.track,(O=u)==null?void 0:O.albumRelease),
7);case 7:T=Number(((q=L.actionMetadata)==null?void 0:q.priority)||0)+1;R=Cd("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B,"playbackData",T,UZL);g.DR(J,6);break;case 5:W=g.wc(J);if(!(W instanceof Error&&W.message==="No data")){if(W instanceof Error&&W.message==="Empty response body")Bg(W.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.St&&W.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),J.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,A,b));J.Iq(6);break}return g.a(J,Gt(B,e.X,L,e.Z),6);case 6:return J.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",c,R?[R]:void 0))}})},KeL=function(e,L){var c,I;
return g.Z(function(B){switch(B.K){case 1:return c=R4(L),g.bn(B,2),I=g.QB(L.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.a(B,kS(e.X,L,e.Z),5):g.a(B,Gt(I,e.X,L,e.Z),6);case 6:return g.a(B,zLU(e.X,L.entityKey),5);case 5:g.DR(B,3);break;case 2:return g.wc(B),B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",c,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new a4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
c))}})},dZJ=function(e,L,c,I,B){var x,S,h,R,u,t;
return g.Z(function(O){switch(O.K){case 1:if(x=I){O.Iq(2);break}return g.a(O,AUN([L]),3);case 3:S=O.X,h=S[0],x=Wa9(h);case 2:return g.a(O,YmL(e,x,L,B,c),4);case 4:R=O.X;u=R.musicTrackEntity;t=R.cn;var q=MH(u.thumbnailDetails),T=[];t&&(T=MH(t.thumbnailDetails));return g.a(O,As(q.concat(T)),0)}})},YmL=function(e,L,c,I,B){var x;
return g.Z(function(S){return S.K==1?(B||(B=Date.now().toString()),x={id:g.dL(c,"musicTrackDownloadMetadataEntity"),playbackData:g.dL(c,"playbackData"),addedTimestampMillis:B,videoDownloadContextEntity:g.dL(c,"videoDownloadContextEntity")},I&&(L.albumRelease=I.id),g.a(S,XE(e.X,{mode:"readwrite",tK:!0},function(h){var R=[],u=Qs(h,x,"musicTrackDownloadMetadataEntity");R.push(u);u=Qs(h,L,"musicTrack");R.push(u);I&&(h=Qs(h,I,"musicAlbumRelease"),R.push(h));return g.qO.all(R)}),2)):S.K!=3?g.a(S,qH(c,"musicTrackDownloadMetadataEntity",
e.X,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):S.return({musicTrackEntity:L,
cn:I})})},nd=function(){dn.apply(this,arguments);
this.D="musicTrack"},n29=function(e,L,c){L=L===void 0?43200:L;
c=c===void 0?!0:c;var I=I===void 0?!1:I;var B,x;return g.Z(function(S){switch(S.K){case 1:if(!e.j.y9())return S.return([]);B=[];g.bn(S,2);return g.a(S,DkU(L,c,I),4);case 4:B=S.X;g.DR(S,3);break;case 2:g.wc(S);case 3:return x=xZM(e,B,c,"musicPlaylist"),S.return(x)}})},eae=function(){g.Vk.apply(this,arguments);
var e=this;this.events=new g.zn(this);this.XM=this.player.S();this.kx={H8_:function(){return e.X},
CO:function(){return e.CO()},
hC:function(L){return e.hC(L)}}},LHM=function(e){var L;
e=g.Q((L=e.getWatchNextResponse())==null?void 0:L.currentVideoEndpoint,g.MD);if(e==null?0:e.playlistId)var c=e.playlistId;return c},cGe=function(e,L){var c,I,B,x;
return g.Z(function(S){if(S.K==1){c=L.clientPlaybackNonce;I={cpn:c,offlineSourceVisualElement:g.uF(L.Y9||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};L.K&&(I.videoFmt=Number(L.K.itag));L.G&&(I.audioFmt=Number(L.G.itag));if((B=LHM(L))&&L.videoId){var h=L.videoId;h=B!=="PPSV"?Promise.resolve(!1):e.X.aj(h);S=g.a(S,h,3)}else S=S.Iq(2);return S}S.K!=2&&(x=S.X)&&(I.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");e.K=c;g.et("offlinePlaybackStarted",I);g.AJ(S)})};
g.p2.prototype.J4=g.xn(45,function(e){return this.app.J4(e)});
g.FH.prototype.J4=g.xn(44,function(e){return g.q8H(this,9,e)});
g.z(ys,mw);g.RH.Object.defineProperties(ys.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.X.entityMetadata},
set:function(e){this.X.entityMetadata=e}}});
g.z(QS7,ys);QS7.prototype.K=function(){return[]};
g.z(d_e,ys);d_e.prototype.K=function(){return[]};
g.z(U_7,ys);U_7.prototype.K=function(){return[]};
g.z(E6w,ys);E6w.prototype.K=function(){return[]};
g.z(Xsg,ys);Xsg.prototype.K=function(){var e=[];this.X.alternateChannel&&e.push(this.X.alternateChannel);this.X.alternateChannelList&&e.push.apply(e,g.V(this.X.alternateChannelList));this.X.oneofChannelEntity&&e.push(this.X.oneofChannelEntity);return[].concat(g.V(new Set(e)))};
g.z(K89,ys);K89.prototype.K=function(){var e=[];this.X.entryCollection&&e.push(this.X.entryCollection);return[].concat(g.V(new Set(e)))};
g.z(Y6N,mw);Y6N.prototype.K=function(){var e=[];this.X.video&&e.push(this.X.video);return[].concat(g.V(new Set(e)))};
g.z(n6h,ys);n6h.prototype.K=function(){var e=[];this.X.parentPlaylist&&e.push(this.X.parentPlaylist);if(this.X.entries)for(var L=g.f(this.X.entries),c=L.next();!c.done;c=L.next())e.push.apply(e,g.V((new Y6N(c.value)).K()));return[].concat(g.V(new Set(e)))};
g.z(eZZ,ys);eZZ.prototype.K=function(){var e=[];this.X.descriptionEntity&&e.push(this.X.descriptionEntity);this.X.creators&&e.push.apply(e,g.V(this.X.creators));this.X.theBiggestFan&&e.push(this.X.theBiggestFan);return[].concat(g.V(new Set(e)))};
g.z(LVh,ys);LVh.prototype.K=function(){return[]};
g.z(cvh,ys);cvh.prototype.K=function(){return[]};
g.z(IHw,ys);IHw.prototype.K=function(){return[]};
g.z(BQ9,ys);BQ9.prototype.K=function(){return[]};
g.z(xzM,ys);xzM.prototype.K=function(){return[]};
g.z(oMh,ys);oMh.prototype.K=function(){return[]};
g.z(SBN,ys);SBN.prototype.K=function(){return[]};
g.z(rvh,ys);rvh.prototype.K=function(){return[]};
g.z(hZM,ys);hZM.prototype.K=function(){return[]};
g.z(RZh,ys);RZh.prototype.K=function(){var e=[];this.X.downloadsList&&e.push(this.X.downloadsList);this.X.smartDownloadsList&&e.push(this.X.smartDownloadsList);this.X.recommendedDownloadsList&&e.push(this.X.recommendedDownloadsList);this.X.refresh&&e.push(this.X.refresh);return[].concat(g.V(new Set(e)))};
g.z(uyg,mw);uyg.prototype.K=function(){var e=[];this.X.video&&e.push(this.X.video);this.X.playlist&&e.push(this.X.playlist);this.X.videoItem&&e.push(this.X.videoItem);this.X.playlistItem&&e.push(this.X.playlistItem);return[].concat(g.V(new Set(e)))};
g.z(tOU,ys);tOU.prototype.K=function(){var e=[];this.X.refresh&&e.push(this.X.refresh);if(this.X.downloads)for(var L=g.f(this.X.downloads),c=L.next();!c.done;c=L.next())e.push.apply(e,g.V((new uyg(c.value)).K()));return[].concat(g.V(new Set(e)))};
g.z(OS9,ys);OS9.prototype.K=function(){var e=[];this.X.localImageEntities&&e.push.apply(e,g.V(this.X.localImageEntities));return[].concat(g.V(new Set(e)))};
g.z(qBw,ys);qBw.prototype.K=function(){var e=[];this.X.playbackData&&e.push(this.X.playbackData);this.X.localImageEntities&&e.push.apply(e,g.V(this.X.localImageEntities));this.X.videoDownloadContextEntity&&e.push(this.X.videoDownloadContextEntity);return[].concat(g.V(new Set(e)))};
g.z(TQe,ys);TQe.prototype.K=function(){return[]};
g.z(WVM,ys);WVM.prototype.K=function(){var e=[];this.X.fakeChildren&&e.push.apply(e,g.V(this.X.fakeChildren));return[].concat(g.V(new Set(e)))};
g.z(MOg,ys);MOg.prototype.K=function(){var e=[];this.X.video&&e.push(this.X.video);this.X.playbackData&&e.push(this.X.playbackData);this.X.offlineVideoPolicy&&e.push(this.X.offlineVideoPolicy);return[].concat(g.V(new Set(e)))};
g.z(zZM,ys);zZM.prototype.K=function(){return[]};
g.z(sjN,ys);sjN.prototype.K=function(){var e=[];this.X.channelOwner&&e.push(this.X.channelOwner);this.X.videos&&e.push.apply(e,g.V(this.X.videos));this.X.collaboratorChannels&&e.push.apply(e,g.V(this.X.collaboratorChannels));this.X.downloadState&&e.push(this.X.downloadState);this.X.refresh&&e.push(this.X.refresh);return[].concat(g.V(new Set(e)))};
g.z(vMN,ys);vMN.prototype.K=function(){var e=[];this.X.video&&e.push(this.X.video);this.X.channelContributor&&e.push(this.X.channelContributor);return[].concat(g.V(new Set(e)))};
g.z(fHL,mw);fHL.prototype.K=function(){var e=[];this.X.localImageEntities&&e.push.apply(e,g.V(this.X.localImageEntities));this.X.videoDownloadContextEntity&&e.push(this.X.videoDownloadContextEntity);return[].concat(g.V(new Set(e)))};
g.z(AvM,mw);AvM.prototype.K=function(){var e=[];this.X.recommendedVideoMetadata&&e.push.apply(e,g.V((new fHL(this.X.recommendedVideoMetadata)).K()));return[].concat(g.V(new Set(e)))};
g.z(FVe,mw);FVe.prototype.K=function(){var e=[];this.X.playbackPosition&&e.push(this.X.playbackPosition);return[].concat(g.V(new Set(e)))};
g.z(bSN,ys);bSN.prototype.K=function(){var e=[];this.X.owner&&e.push(this.X.owner);this.X.downloadState&&e.push(this.X.downloadState);this.X.userState&&e.push.apply(e,g.V((new FVe(this.X.userState)).K()));this.X.additionalMetadata&&e.push.apply(e,g.V((new AvM(this.X.additionalMetadata)).K()));return[].concat(g.V(new Set(e)))};
g.z(iSw,ys);iSw.prototype.K=function(){var e=[];this.X.userChannelDetails&&e.push(this.X.userChannelDetails);return[].concat(g.V(new Set(e)))};
g.z(GQL,ys);GQL.prototype.K=function(){var e=[];this.X.channelOwner&&e.push(this.X.channelOwner);this.X.playbackPosition&&e.push(this.X.playbackPosition);this.X.localImageEntities&&e.push.apply(e,g.V(this.X.localImageEntities));this.X.downloadStatus&&e.push(this.X.downloadStatus);return[].concat(g.V(new Set(e)))};
g.z(gM7,ys);gM7.prototype.K=function(){return[]};
g.z(kQ9,ys);kQ9.prototype.K=function(){return[]};
g.z(DzJ,ys);DzJ.prototype.K=function(){return[]};
g.z(w9M,ys);w9M.prototype.K=function(){return[]};
g.z(JvU,ys);JvU.prototype.K=function(){return[]};
g.z(VOM,ys);VOM.prototype.K=function(){return[]};
g.z(Cmg,ys);Cmg.prototype.K=function(){return[]};
g.z(aHe,ys);aHe.prototype.K=function(){return[]};
g.z(NQw,ys);NQw.prototype.K=function(){return[]};
g.z(mzL,ys);mzL.prototype.K=function(){return[]};
g.z(yvN,ys);yvN.prototype.K=function(){return[]};
g.z(ZSL,ys);ZSL.prototype.K=function(){return[]};
g.z(p97,ys);p97.prototype.K=function(){var e=[];this.X.trackDownloadMetadatas&&e.push.apply(e,g.V(this.X.trackDownloadMetadatas));return[].concat(g.V(new Set(e)))};
g.z($zN,ys);
$zN.prototype.K=function(){var e=[];this.X.downloadedTracks&&e.push.apply(e,g.V(this.X.downloadedTracks));this.X.smartDownloadedTracks&&e.push.apply(e,g.V(this.X.smartDownloadedTracks));this.X.downloadedEpisodes&&e.push.apply(e,g.V(this.X.downloadedEpisodes));this.X.downloadedAlbumReleases&&e.push.apply(e,g.V(this.X.downloadedAlbumReleases));this.X.smartDownloadedAlbumReleases&&e.push.apply(e,g.V(this.X.smartDownloadedAlbumReleases));this.X.downloadedPlaylists&&e.push.apply(e,g.V(this.X.downloadedPlaylists));this.X.smartDownloadedPlaylists&&
e.push.apply(e,g.V(this.X.smartDownloadedPlaylists));this.X.metadataOnlyTracks&&e.push.apply(e,g.V(this.X.metadataOnlyTracks));return[].concat(g.V(new Set(e)))};
g.z(jj7,ys);jj7.prototype.K=function(){var e=[];this.X.trackDownloadMetadatas&&e.push.apply(e,g.V(this.X.trackDownloadMetadatas));return[].concat(g.V(new Set(e)))};
g.z(HSL,ys);HSL.prototype.K=function(){var e=[];this.X.playbackData&&e.push(this.X.playbackData);this.X.localImageEntities&&e.push.apply(e,g.V(this.X.localImageEntities));this.X.videoDownloadContextEntity&&e.push(this.X.videoDownloadContextEntity);return[].concat(g.V(new Set(e)))};
g.z(lHh,ys);lHh.prototype.K=function(){var e=[];this.X.musicLibraryStatusEntity&&e.push(this.X.musicLibraryStatusEntity);this.X.primaryArtists&&e.push.apply(e,g.V(this.X.primaryArtists));this.X.details&&e.push(this.X.details);this.X.userDetails&&e.push(this.X.userDetails);this.X.tracks&&e.push.apply(e,g.V(this.X.tracks));this.X.share&&e.push(this.X.share);this.X.downloadMetadata&&e.push(this.X.downloadMetadata);this.X.refresh&&e.push(this.X.refresh);return[].concat(g.V(new Set(e)))};
g.z(Pme,ys);Pme.prototype.K=function(){var e=[];this.X.albumRelease&&e.push(this.X.albumRelease);this.X.tracks&&e.push.apply(e,g.V(this.X.tracks));return[].concat(g.V(new Set(e)))};
g.z(QjU,ys);QjU.prototype.K=function(){var e=[];this.X.albumRelease&&e.push(this.X.albumRelease);return[].concat(g.V(new Set(e)))};
g.z(dzw,ys);dzw.prototype.K=function(){var e=[];this.X.details&&e.push(this.X.details);this.X.userDetails&&e.push(this.X.userDetails);return[].concat(g.V(new Set(e)))};
g.z(Uz7,ys);Uz7.prototype.K=function(){var e=[];this.X.parentArtist&&e.push(this.X.parentArtist);return[].concat(g.V(new Set(e)))};
g.z(EMe,ys);EMe.prototype.K=function(){var e=[];this.X.parentArtist&&e.push(this.X.parentArtist);return[].concat(g.V(new Set(e)))};
g.z(X9e,ys);X9e.prototype.K=function(){return[]};
g.z(KVM,ys);KVM.prototype.K=function(){return[]};
g.z(YBg,mw);YBg.prototype.K=function(){var e=[];this.X.creatorEntity&&e.push(this.X.creatorEntity);return[].concat(g.V(new Set(e)))};
g.z(nM9,ys);
nM9.prototype.K=function(){var e=[];this.X.tracks&&e.push.apply(e,g.V(this.X.tracks));this.X.refresh&&e.push(this.X.refresh);this.X.musicLibraryStatusEntity&&e.push(this.X.musicLibraryStatusEntity);this.X.details&&e.push(this.X.details);this.X.downloadMetadata&&e.push(this.X.downloadMetadata);this.X.sideloadMetadata&&e.push(this.X.sideloadMetadata);this.X.userDetails&&e.push(this.X.userDetails);this.X.entryCollection&&e.push(this.X.entryCollection);this.X.share&&e.push(this.X.share);this.X.podcastShowAdditionalMetadata&&e.push.apply(e,
g.V((new YBg(this.X.podcastShowAdditionalMetadata)).K()));return[].concat(g.V(new Set(e)))};
g.z(e$7,ys);e$7.prototype.K=function(){return[]};
g.z(LIL,ys);
LIL.prototype.K=function(){var e=[];this.X.musicLibraryStatusEntity&&e.push(this.X.musicLibraryStatusEntity);this.X.artists&&e.push.apply(e,g.V(this.X.artists));this.X.audioModeVersion&&e.push(this.X.audioModeVersion);this.X.videoModeVersion&&e.push(this.X.videoModeVersion);this.X.userDetails&&e.push(this.X.userDetails);this.X.details&&e.push(this.X.details);this.X.albumRelease&&e.push(this.X.albumRelease);this.X.share&&e.push(this.X.share);this.X.libraryEdit&&e.push(this.X.libraryEdit);this.X.downloadMetadata&&
e.push(this.X.downloadMetadata);this.X.playbackPosition&&e.push(this.X.playbackPosition);this.X.lyrics&&e.push(this.X.lyrics);return[].concat(g.V(new Set(e)))};
g.z(cxe,ys);cxe.prototype.K=function(){var e=[];this.X.parentTrack&&e.push(this.X.parentTrack);return[].concat(g.V(new Set(e)))};
g.z(ITZ,ys);ITZ.prototype.K=function(){var e=[];this.X.parentTrack&&e.push(this.X.parentTrack);return[].concat(g.V(new Set(e)))};
g.z(BUM,ys);BUM.prototype.K=function(){return[]};
g.z(x1e,ys);x1e.prototype.K=function(){return[]};
g.z(o7h,ys);o7h.prototype.K=function(){return[]};
g.z(SpM,ys);SpM.prototype.K=function(){return[]};
g.z(rxN,ys);rxN.prototype.K=function(){var e=[];this.X.transfer&&e.push(this.X.transfer);this.X.adsPlaybackData&&e.push.apply(e,g.V(this.X.adsPlaybackData));this.X.drmLicense&&e.push(this.X.drmLicense);this.X.offlineVideoPolicy&&e.push(this.X.offlineVideoPolicy);this.X.videoDownloadContextEntity&&e.push(this.X.videoDownloadContextEntity);return[].concat(g.V(new Set(e)))};
g.z(h$N,ys);h$N.prototype.K=function(){return[]};
g.z(R$L,ys);R$L.prototype.K=function(){var e=[];this.X.offlineVideoStreams&&e.push.apply(e,g.V(this.X.offlineVideoStreams));this.X.captionTrack&&e.push.apply(e,g.V(this.X.captionTrack));return[].concat(g.V(new Set(e)))};
g.z(uCN,ys);uCN.prototype.K=function(){return[]};
g.z(tyN,ys);tyN.prototype.K=function(){return[]};
g.z(OMM,ys);OMM.prototype.K=function(){return[]};
g.z(qpL,ys);qpL.prototype.K=function(){return[]};
g.z(TUe,ys);TUe.prototype.K=function(){return[]};
g.z(WIe,ys);WIe.prototype.K=function(){return[]};
g.z(My7,ys);My7.prototype.K=function(){return[]};
g.z(z$N,ys);z$N.prototype.K=function(){return[]};
g.z(sm7,ys);sm7.prototype.K=function(){return[]};
g.z(v7e,ys);v7e.prototype.K=function(){return[]};
g.z(fTZ,ys);fTZ.prototype.K=function(){return[]};
g.z(Axe,ys);Axe.prototype.K=function(){return[]};
g.z(FIJ,ys);FIJ.prototype.K=function(){return[]};
g.z(bMM,ys);bMM.prototype.K=function(){return[]};
g.z(iM7,ys);iM7.prototype.K=function(){return[]};
g.z(GTN,ys);GTN.prototype.K=function(){return[]};
g.z(g77,ys);g77.prototype.K=function(){return[]};
g.z(kTL,ys);kTL.prototype.K=function(){return[]};
g.z(D1Z,ys);D1Z.prototype.K=function(){return[]};
g.z(wkZ,ys);wkZ.prototype.K=function(){return[]};
g.z(JxL,ys);JxL.prototype.K=function(){return[]};
var w0L=["browse","music/browse","unplugged/browse"],NkN=["offline/playlist_sync_check"],fXN=["offline"],JUe=["offline/offline_video_playback_position_sync"],CrL=["offline/get_playback_data_entity"],Zq;p9.getInstance=function(){return g.Z(function(e){return e.return(new Promise(function(L){g.HK().then(function(c){c?(p9.instance||(p9.instance=new p9(c)),L(p9.instance)):L(void 0)})}))})};
p9.prototype.get=function(e){var L=this,c,I,B;return g.Z(function(x){if(x.K==1)return g.a(x,NUe(L.token),2);if(x.K!=3)return c=x.X,g.a(x,c.get("prefs",e),3);I=x.X;if(!I)return x.return();B=(0,g.zI)();return I.expirationTimestampMs<=B?x.return():x.return(I.value)})};
p9.prototype.set=function(e,L,c){c=c===void 0?31536E3:c;var I=this,B,x,S;return g.Z(function(h){if(h.K==1)return B=(0,g.zI)(),x={key:e,value:L,expirationTimestampMs:B+c*1E3},g.a(h,NUe(I.token),2);S=h.X;return g.a(h,g.bE(S,"prefs",x),0)})};
p9.prototype.remove=function(e){var L=this,c;return g.Z(function(I){if(I.K==1)return g.a(I,NUe(L.token),2);c=I.X;return g.a(I,c.delete("prefs",e),0)})};
g.z($U,g.yu);g.z(j7,$1L);j7.prototype.Z=function(e,L){L=HMZ(L);e=(new TextEncoder).encode(JSON.stringify(e));return this.X.encrypt(e,L)};
j7.prototype.K=function(e,L){if(!(e instanceof Uint8Array))throw m1e(1);var c=new TextDecoder;L=HMZ(L);e=this.X.decrypt(e,L);return JSON.parse(c.decode(e))};
var lTM={accountLinkStatusEntity:IHw,booleanEntity:U_7,buttonEntity:bMM,captionTrack:BUM,channelHandle:QS7,chipEntity:My7,commerceAcquisitionClientPayloadEntity:GTN,commerceCartListEntity:g77,contextNoteFeedEntityPayload:d_e,continuationTokenEntity:zZM,downloadQualityPickerEntity:SBN,downloadsPageRefreshTokenEntity:hZM,downloadsPageViewConfigurationEntity:gM7,downloadStatusEntity:rvh,dismissState:z$N,sfvAudioItemCurrentlyPlayingEntity:qpL,emojiFountainDataEntity:Axe,emojiCustomizationSetEntity:fTZ,
fakeChannel:Xsg,fakePlaylist:K89,fakePlaylistEntryCollection:n6h,fakeVideo:eZZ,fakeVideoDescription:LVh,featuredProductsEntity:mzL,flowStateEntity:cvh,iconBadgeEntity:kTL,interstitialInteractionStateEntity:xzM,likeButtonAnimationEntity:kQ9,liveChatPollStateEntity:oMh,liveViewerLeaderboardChatEntryPointStateEntity:tyN,liveViewerLeaderboardPointsEntity:OMM,liveReactionsDataEntity:FIJ,logoEntity:BQ9,macroMarkerEntity:DzJ,mainDownloadsLibraryEntity:RZh,mainDownloadsListEntity:tOU,mainPlaylistDownloadStateEntity:OS9,
mainPlaylistEntity:sjN,mainPlaylistVideoEntity:vMN,mainVideoDownloadStateEntity:qBw,mainVideoEntity:bSN,markersEngagementPanelSyncEntity:w9M,markersVisibilityOverrideEntity:JvU,musicAlbumReleaseDetail:Pme,musicAlbumReleaseDownloadMetadataEntity:p97,musicAlbumRelease:lHh,musicAlbumReleaseUserDetail:QjU,musicArtistDetail:Uz7,musicArtist:dzw,musicArtistUserDetail:EMe,musicDownloadsLibraryEntity:$zN,musicLibraryEdit:X9e,musicLibraryStatusEntity:KVM,musicPlaylist:nM9,musicPlaylistDownloadMetadataEntity:jj7,
musicShare:e$7,musicTrackDetail:cxe,musicTrackDownloadMetadataEntity:HSL,musicTrack:LIL,musicTrackUserDetail:ITZ,offlineOrchestrationActionWrapperEntity:x1e,offlineVideoPolicy:o7h,offlineVideoStreams:SpM,offlineabilityEntity:TQe,orchestrationWebSamplingEntity:WVM,pageHeaderEntity:sm7,pdpStateEntity:D1Z,pinnedProductEntity:yvN,playbackData:rxN,playerStateEntity:VOM,quantityIncrementerEntity:wkZ,refresh:h$N,saveToPlaylistListEntity:TUe,selectedChipIndexEntityPayload:Cmg,settingEntity:WIe,stringEntity:E6w,
suggestedFeedbackChipStateEntity:aHe,transfer:R$L,trendingOfferEntity:ZSL,videoDownloadContextEntity:uCN,videoOverviewAsyncDataEntity:JxL,videoPlaybackPositionEntity:iM7,votingEntity:v7e,ytMainChannelEntity:iSw,youchatPendingResponseEntity:NQw,ytMainDownloadedVideoEntity:MOg,ytMainVideoEntity:GQL};g.z(U0,$1L);U0.prototype.Z=function(e){return e};
U0.prototype.K=function(e){if(e instanceof Uint8Array)throw m1e(0);return e};
g.z(E0,g.p);E0.prototype.observe=function(e){var L=this;this.observers.push(e);return function(){var c=L.observers.indexOf(e);c>=0&&L.observers.splice(c,1)}};
E0.prototype.K=function(e){BTZ(this,e.data)};
E0.prototype.KS=function(){this.channel.close()};
var hpN,SAJ=new g.MN("elementsCommand");var b4=new g.MN("entityBatchUpdate");var EAL=new g.MN("downloadStatusEntity");var uZL=new g.MN("mainPlaylistEntityActionMetadata");var Xf=new g.MN("mainVideoEntityActionMetadata");var vdL=new g.MN("musicPlaylistEntityActionMetadata");var QAe=new g.MN("musicTrackEntityActionMetadata");var GlZ=new g.MN("localImageEntityActionMetadata");var NH=new g.MN("playbackDataActionMetadata");var rSh=new g.MN("transferEntityActionMetadata");var dkZ=new g.MN("videoPlaybackPositionEntityActionMetadata");var bcN;new g.rk;new g.rk;DqL.prototype.request=function(e,L,c){L=L===void 0?{}:L;return this.locks.request(e,L,function(I){return c(I)})};var I4=g.LZ.caches,cg,aSe;Ld.prototype.open=function(e){return I4.open(VAN(e))};
Ld.prototype.has=function(e){return I4.has(VAN(e))};
Ld.prototype.delete=function(e){return I4.delete(VAN(e))};
Ld.prototype.match=function(e,L){var c=this,I,B,x,S,h,R;return g.Z(function(u){switch(u.K){case 1:return g.a(u,c.keys(),2);case 2:I=u.X,B=g.f(I),x=B.next();case 3:if(x.done){u.Iq(5);break}S=x.value;return g.a(u,c.open(S),6);case 6:return h=u.X,g.a(u,h.match(e,L),7);case 7:if(R=u.X)return u.return(R);x=B.next();u.Iq(3);break;case 5:return u.return()}})};
g.z(JiU,Ld);JiU.prototype.keys=function(){var e,L,c,I,B,x,S,h,R;return g.Z(function(u){if(u.K==1)return e=[],L=g.Z8("CacheStorage keys"),g.a(u,I4.keys(),2);c=u.X;I=g.f(c);for(B=I.next();!B.done;B=I.next()){x=B.value;var t=x.indexOf(":");S=t===-1?{ES:x}:{ES:x.substring(0,t),datasyncId:x.substring(t+1)};h=S.ES;R=S.datasyncId;R===L&&e.push(h)}return u.return(e)})};g.z(xS,g.p);xS.prototype.Z=function(e){this.api.fS("onOfflineOperationFailure",e.data)};
xS.prototype.G=function(e){this.api.publish("offlinetransferpause",e.data)};
xS.prototype.KS=function(){var e;(e=this.X)==null||e.close();var L;(L=this.K)==null||L.close()};yiZ.prototype.dZ=function(){this.X&&SV(this)};
yiZ.prototype.tf=function(){this.K&&this.K.resolve();this.Z=this.X=!1;this.D()};var bsZ=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Bk9="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Tk9="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.z(yUL,Vx);yUL.prototype.K=function(e){return u4(e)?$kL(this,e):ts(e)?lXM(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};g.z(Prw,Vx);Prw.prototype.K=function(e){return ts(e)?QdN(this,e):Uqw(e)?UkM(this,e):OM(e)?Edw(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};g.M=X0Z.prototype;g.M.HSq=function(e){var L=this,c,I,B,x;return g.Z(function(S){if(!g.E(e.state,128))return S.Iq(0);c=e.state.lz;var h=(I=c)==null?void 0:I.errorCode,R=(B=c)==null?void 0:B.wF;x=h==="net.connect"&&R===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(h==null?0:h.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.a(S,L.vG(L.player.getVideoData().videoId,x),0)})};
g.M.vG=function(e,L){var c=this;return g.Z(function(I){if(I.K==1){if(c.K)return I.return();c.K=!0;return L==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Zg(c,e,!1,!0),I.Iq(0)):g.a(I,yx(c,e),3)}g.K8(e,4);return g.a(I,c.X.vG(L),0)})};
g.M.dD=function(e){e.status===2?(e.status!==this.Z&&(Qb9(this.X),g.K8(e.videoId,2)),e.r3&&KnZ(this.X,e.videoId,e.r3)):e.status===4?(yx(this,e.videoId),this.vG(e.videoId,e.wm?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):e.status===1&&XTN(this.X);this.Z=e.status;this.api.fS("localmediachange",{videoId:e.videoId,status:e.status})};
g.M.Sx=function(){var e=this,L;return g.Z(function(c){if(c.K==1){if(e.K)return c.return();e.K=!0;L=e.player.getVideoData().videoId;return g.a(c,yx(e,L),2)}return g.a(c,e.X.Sx(),0)})};
g.M.cO=function(e){switch(e){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.M.Y=function(e){return this.api.S().Y(e)};g.z(I$9,Vx);I$9.prototype.K=function(e){return u4(e)?xAw(this,e):ts(e)?o4N(this,e):Uqw(e)?S1e(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};Osw.prototype.X=function(e,L){var c=e.action.actionMetadata.priority-L.action.actionMetadata.priority;c===0&&(e.X<L.X?c=-1:e.X>L.X&&(c=1));return c};g.z(pd,g.p);pd.prototype.KS=function(){this.D&&this.D();g.p.prototype.KS.call(this)};
pd.prototype.createAction=function(e,L){var c=g.QB(e.entityKey).entityType,I=g.Rp(16);return new zt(c,I,e,L.actionId,L.rootActionId)};
pd.prototype.h7=function(e){var L=this,c,I,B,x,S,h,R,u,t;return g.Z(function(O){if(O.K==1){if(L.We())return O.return();I=(c=e.offlineOrchestrationActionWrapperEntity)!=null?c:new Set;B=[];x=g.f(I);for(S=x.next();!S.done;S=x.next())h=S.value,R=g.QB(h),u=R.entityId,Wn9(L.X,u)||B.push(h);return g.a(O,g4M(L,B),2)}t=O.X;return g.a(O,Gfe(L,t),0)})};
pd.prototype.retry=function(){var e=this;return g.Z(function(L){return g.a(L,kf9(e),0)})};wT7.prototype.Aa=function(e,L){L=L===void 0?!0:L;var c=this,I,B,x,S,h,R,u,t;return g.Z(function(O){switch(O.K){case 1:if(!c.X)return O.return();I=[];B=g.ua(c.X.K,L);x=[];for(S={hS:0};S.hS<B.length;S={hS:S.hS},S.hS++)h=B[S.hS],R=c.X.tI(h,"json3"),u=g.v3(R,{withCredentials:!0,format:"RAW"},3,500).then(function(q){return function(T){T={metadata:g.Nu(B[q.hS]),trackData:T.xhr.responseText};x.push(T)}}(S)).XR(function(q){Bg("Caption fetch error",q)}),I.push(u);
return g.a(O,Pg7(I),2);case 2:return g.bn(O,3),g.a(O,MAe(e,x),5);case 5:g.DR(O,0);break;case 3:t=g.wc(O),Bg("Caption DB transaction error",t),g.AJ(O)}})};g.z($S,g.p);$S.prototype.KS=function(){this.K&&this.K();g.p.prototype.KS.call(this)};
$S.prototype.Z=function(e){var L=this,c,I,B,x,S,h,R,u;return g.Z(function(t){I=(c=e.transfer)!=null?c:new Set;B=[];x=g.f(I);for(S=x.next();!S.done;S=x.next())h=S.value,R=g.QB(h),u=R.entityId,B.push(u);return B.length===0?t.return():g.a(t,CBN(L,B),0)})};g.z(ZsM,g.p);g.M=ZsM.prototype;g.M.KS=function(){this.Gm&&this.Gm();this.k9.dispose();this.G.dispose();this.Y9&&g.Up(this.j.c_,this.Y9);this.ye&&g.Up(this.j.c_,this.ye);g.p.prototype.KS.call(this)};
g.M.YRW=function(e){var L=this,c,I,B;return g.Z(function(x){switch(x.K){case 1:c=g.dL(e,"transfer");if(L.X&&c===L.X.key){Zg(L.T,L.B,!0);L.G.stop();x.Iq(0);break}return g.a(x,XE(L.K,{mode:"readwrite",tK:!0},function(S){return HV(S,c,"transfer").then(function(h){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!=="TRANSFER_STATE_FAILED")return h.transferState="TRANSFER_STATE_PAUSED_BY_USER",Qs(S,h,"transfer").then(function(){return h})})}),3);
case 3:I=x.X;if(!I){x.Iq(0);break}if(!e||!L.Z){x.Iq(5);break}return g.a(x,qH(e,L.Z,L.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.a(x,l4(L,e),7);case 7:B=x.X,Q$N({videoId:e,zc:I,offlineModeType:B}),g.AJ(x)}})};
g.M.Rdm=function(){var e=this;if(this.X&&this.B){Zg(this.T,this.B,!1);var L=this.X,c=(L==null?0:L.key)?g.QB(L.key).entityId:"";c&&this.Z&&(new Promise(function(I,B){qH(c,e.Z,e.K,"DOWNLOAD_STATE_PAUSED").catch(function(x){B(x)})})).catch(function(I){Bg("Download state setting error",I)})}this.G.stop()};
g.M.MJ=function(){this.X?jbN(this,this.X):Hg(this)};
g.M.Lc=function(e){var L=this;return g.Z(function(c){switch(c.K){case 1:if(!L.X){c.Iq(2);break}if(L.X.transferState==="TRANSFER_STATE_COMPLETE"||L.X.transferState==="TRANSFER_STATE_FAILED"||!e.transfer||!e.transfer.has(L.X.key)){c.Iq(3);break}return g.a(c,YU(L.K,L.X.key,"transfer"),4);case 4:L.X=c.X;if(L.X){c.Iq(3);break}return g.a(c,Hsh(L),3);case 3:if(L.X)return c.return();case 2:return g.a(c,Hg(L),0)}})};
g.M.vG=function(e,L){var c=this,I,B,x,S,h;return g.Z(function(R){switch(R.K){case 1:if(!c.X){Pg(c,"onTransferFailure: "+e);R.Iq(2);break}I=c.X;x=((B=I)==null?0:B.key)?g.QB(I.key).entityId:"";a:switch(e){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var u=!1;break a;default:u=!0}return u&&Y1e(c)?g.a(R,Qx(c,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.a(R,
n4Z(c,e),5);case 5:if(!x||!c.Z){R.Iq(2);break}return g.a(R,qH(x,c.Z,c.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.a(R,l4(c,x),9);case 9:S=R.X;hs({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:x,zc:I,offlineModeType:S});if(!x||!c.Z){R.Iq(2);break}return g.a(R,qH(x,c.Z,c.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:jV(c),h=Hg(c,!0),L&&L(h),g.AJ(R)}})};
g.M.Sx=function(e){var L=this,c,I,B,x,S,h,R,u,t,O,q,T;return g.Z(function(W){switch(W.K){case 1:if(!L.X){Pg(L,"onMaybeTransferStreamsExpired");W.Iq(2);break}return Y1e(L)?g.a(W,Qx(L,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.a(W,n4Z(L,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!L.Z){W.Iq(2);break}c=L.X;B=((I=c)==null?0:I.key)?g.QB(c.key).entityId:"";if(!B){W.Iq(2);break}return g.a(W,qH(B,L.Z,L.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return L.X||Pg(L,"onMaybeTransferStreamsExpiredRetryAttempting"),
x=L.X,h=((S=x)==null?0:S.key)?g.QB(x.key).entityId:"",g.a(W,l4(L,h),10);case 10:return R=W.X,hs({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:h,zc:x,offlineModeType:R}),u=Yae(),g.kg(u,NH,{isEnqueuedForExpiredStreamUrlRefetch:!0}),t=g.dL(h,"playbackData"),O={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:t,actionMetadata:u},q=vg(new zt("playbackData",h,O)),g.a(W,K9(L.K,q,"offlineOrchestrationActionWrapperEntity"),2);case 2:jV(L),T=Hg(L,!0),
e&&e(T),g.AJ(W)}})};
var IuL={},eQM=(IuL.TRANSFER_STATE_TRANSFERRING=1,IuL.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,IuL);g.M=dn.prototype;g.M.Os=function(){return this.B.promise};
g.M.HV=function(){if(this.K&&this.T)return this.B.promise;IWJ(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise};
g.M.U8=function(e){var L={};return L.playbackData=new yUL(e,this.XM,this.X),L.transfer=new I$9(e,this.XM),L.videoPlaybackPositionEntity=new Prw(e,this.XM),L};
g.M.z3=function(){var e=this;return g.Z(function(L){return e.K?g.a(L,pTh(e.K),0):L.Iq(0)})};
g.M.Nb=function(){var e=this,L,c;return g.Z(function(I){if(I.K==1)return e.K||e.T?g.a(I,e.Os(),2):I.return();e.J!==void 0&&(g.hF(e.J),e.J=void 0);e.G!==void 0&&(g.hF(e.G),e.G=void 0);(L=e.K)==null||L.dispose();e.K=void 0;(c=e.T)==null||c.dispose();e.T=void 0;e.api.fS("onOrchestrationLostLeader");e.B=new g.rk;g.AJ(I)})};
g.M.isOrchestrationLeader=function(){return this.Z.X};
g.M.aj=function(){return g.Z(function(e){return e.return(!1)})};
g.M.uI=function(e){var L=this.X;L.api.publish("offlinetransferpause",e);var c;(c=L.K)==null||c.postMessage(e)};
g.M.MJ=function(e){var L,c;return g.Z(function(I){if(I.K==1)return g.a(I,eV(),2);L=I.X;if(!L)return I.return();c=g.dL(e,"transfer");return g.a(I,XE(L,{mode:"readwrite",tK:!0},function(B){var x=HV(B,c,"transfer"),S=HV(B,g.dL(e,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.qO.all([x,S]).then(function(h){h=g.f(h);var R=h.next().value;var u=h.next().value;return R&&R.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(R.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Qs(B,R,"transfer").then(function(){hs({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:e,zc:R,offlineModeType:u==null?void 0:u.offlineModeType});return g.qO.resolve(null)})):g.qO.resolve(null)})}),0)})};
g.M.dI=function(e){e=e===void 0?43200:e;var L=this,c,I,B,x,S,h,R,u;return g.Z(function(t){if(t.K==1)return L.j.y9()?g.a(t,eV(),2):t.return(BpZ());if(t.K!=3){c=t.X;if(!c)return t.return([]);I=Date.now()/1E3;return g.a(t,n9(c,"offlineVideoPolicy"),3)}B=t.X;x=[];S=g.f(B);for(h=S.next();!h.done;h=S.next())R=h.value,Number(R.lastUpdatedTimestampSeconds)+e<=I&&(u=g.QB(R.key).entityId,x.push(u));return x.length?t.return(UM(L,x,L.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):t.return([])})};
g.M.deleteAll=function(){return UM(this,["!*$_ALL_ENTITIES_!*$"],this.D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.M.refreshAllStaleEntities=function(e){var L=this;return g.Z(function(c){return c.K==1?g.a(c,L.dI(e),2):c.return(c.X)})};
g.M.setUpPositionSyncInterval=function(e){var L=this;this.G!==void 0&&(g.hF(this.G),this.G=void 0);var c=e!=null?e:864E5;this.G=g.SG(function(){L.ZX(c)},c)};
g.M.ZX=function(e){var L=this,c,I,B,x,S,h;return g.Z(function(R){switch(R.K){case 1:return g.bn(R,2),g.a(R,p9.getInstance(),4);case 4:c=R.X;if(!c)throw Error("prefStorage is undefined");return g.a(R,c.get("psi"),5);case 5:I=R.X;x=((B=I)==null?0:B.iX)?Number(I.iX)/1E3:0;S=Date.now();if(!(x+e<=S)){R.Iq(6);break}return g.a(R,UM(L,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.DR(R,0);break;case 2:h=g.wc(R),Bg("Offline manager error",h),
g.AJ(R)}})};
g.M.xA=function(){var e=this,L,c,I,B,x,S,h;return g.Z(function(R){if(R.K==1)return g.a(R,eV(),2);if(R.K!=3)return(L=R.X)?g.a(R,n9(L,"transfer"),3):R.return([]);c=R.X;I=[];B=g.f(c);for(x=B.next();!x.done;x=B.next())S=x.value,S.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&S.key&&(h=g.QB(S.key).entityId,I.push(h));return R.return(o2M(e,I))})};
g.M.Ib=function(){return g.Z(function(e){return e.return([])})};
g.M.AN=function(){return g.Z(function(e){g.AJ(e)})};
g.M.UO=function(){return g.Z(function(e){g.AJ(e)})};g.z(Sme,Vx);Sme.prototype.K=function(e){return u4(e)?RQe(this,e):ts(e)?tZe(this,e):OM(e)?O1w(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var EM=[10];g.z(zQN,Vx);zQN.prototype.K=function(e){return u4(e)?fWe(this,e):ts(e)?ALL(this,e):OM(e)?Fe7(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var v2L=[10];g.z(i1w,Vx);i1w.prototype.K=function(e){return ts(e)?g2M(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};g.z(klL,dn);g.M=klL.prototype;g.M.U8=function(e){var L=dn.prototype.U8.call(this,e);L.mainVideoEntity=new zQN(e,this.XM,this.X);L.mainPlaylistEntity=new Sme(e,this.XM,this.X);L.mainDownloadsListEntity=new i1w(e,this.XM,this.X);return L};
g.M.refreshAllStaleEntities=function(e,L){var c=this,I,B,x,S,h,R,u,t,O,q,T;return g.Z(function(W){switch(W.K){case 1:I=[];if(!c.XM.Y("web_player_offline_playlist_auto_refresh")){W.Iq(2);break}return g.a(W,DZL(c,e,L),3);case 3:I=W.X;case 2:return g.a(W,p9.getInstance(),4);case 4:return B=W.X,g.a(W,(x=B)==null?void 0:x.get("sdois"),5);case 5:return S=W.X,g.a(W,(h=B)==null?void 0:h.get("lmqf"),6);case 6:R=W.X;if(!S){W.Iq(7);break}t=I;O=t.concat;return g.a(W,wYU(c,S,(u=R)!=null?u:"SD",e===0),8);case 8:I=
O.call(t,W.X);case 7:return q=I,T=q.concat,g.a(W,dn.prototype.refreshAllStaleEntities.call(c,e,L),9);case 9:return I=T.call(q,W.X),W.return(I)}})};
g.M.aj=function(e){var L,c,I,B,x,S,h,R;return g.Z(function(u){if(u.K==1)return g.a(u,eV(),2);if(u.K!=3)return(L=u.X)?g.a(u,YU(L,g.Hj,"mainDownloadsListEntity"),3):u.return(!1);c=u.X;if((I=c)==null?0:(B=I.downloads)==null?0:B.length)for(x=g.dL(e,"mainVideoEntity"),S=g.f(c.downloads),h=S.next();!h.done;h=S.next())if(R=h.value,R.videoItem===x)return u.return(!0);return u.return(!1)})};
g.M.Ib=function(){var e=this,L,c,I,B,x,S,h,R;return g.Z(function(u){if(u.K==1)return g.a(u,eV(),2);if(u.K!=3)return(L=u.X)?g.a(u,n9(L,"downloadStatusEntity"),3):u.return([]);c=u.X;I=[];B=g.f(c);for(x=B.next();!x.done;x=B.next())S=x.value,S.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&S.key&&(h=g.QB(S.key).entityId,I.push(h));return I.length?(R={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},u.return(UM(e,I,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
R))):u.return([])})};
g.M.UO=function(){var e;return g.Z(function(L){return L.K==1?g.a(L,eV(),2):(e=L.X)?g.a(L,XE(e,{mode:"readwrite",tK:!0},function(c){return l9(c,"mainVideoEntity").then(function(I){var B=[];I=g.f(I);for(var x=I.next();!x.done;x=I.next()){x=x.value;var S=void 0;(S=x.userState)!=null&&S.playbackPosition||(S=g.QB(x.key).entityId,S={key:g.dL(S,"videoPlaybackPositionEntity"),videoId:S,lastPlaybackPositionSeconds:"0"},B.push(Qs(c,S,"videoPlaybackPositionEntity")),x.userState={playbackPosition:S.key},B.push(Qs(c,
x,"mainVideoEntity")))}return g.qO.all(B)})}),0):L.return()})};
g.M.AN=function(){var e,L,c,I,B,x,S,h,R,u,t,O,q,T,W,A,b,J,w,C,y,P,ev,X,oH,rc,Sv,tJ,cM,JJ,yr,cU,$N,fZ,$n,nZ,Mg,QM;return g.Z(function(Is){if(Is.K==1)return g.a(Is,eV(),2);if(Is.K!=3){e=Is.X;if(!e)return Is.return();L=g.dL("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.a(Is,XE(e,{mode:"readonly",tK:!0},function(D){return g.qO.all([HV(D,L,"mainDownloadsListEntity"),HV(D,g.Hj,"mainDownloadsListEntity"),l9(D,"mainVideoEntity"),l9(D,"mainPlaylistEntity")])}),3)}c=Is.X;
I=g.f(c);B=I.next().value;x=I.next().value;S=I.next().value;h=I.next().value;R=B;u=x;t=S;O=h;q=new Set;if((T=R)==null?0:(W=T.downloads)==null?0:W.length)for(A=g.f(R.downloads),b=A.next();!b.done;b=A.next())J=b.value,w=void 0,(C=(w=J.videoItem)!=null?w:J.playlistItem)&&q.add(C);if((y=u)==null?0:(P=y.downloads)==null?0:P.length)for(ev=g.f(u.downloads),X=ev.next();!X.done;X=ev.next())oH=X.value,oH.videoItem&&q.add(oH.videoItem);rc=new Set;Sv=[];tJ=g.f(O);for(cM=tJ.next();!cM.done;cM=tJ.next()){JJ=cM.value;
if(JJ.videos)for(yr=g.f(JJ.videos),cU=yr.next();!cU.done;cU=yr.next())$N=cU.value,(fZ=JSON.parse(g.QB($N).entityId).videoId)&&rc.add(fZ);JJ.key&&!q.has(JJ.key)&&Sv.push(JJ.key)}$n=g.f(t);for(nZ=$n.next();!nZ.done;nZ=$n.next())Mg=nZ.value,Mg.key&&!q.has(Mg.key)&&(QM=g.QB(Mg.key).entityId,rc.has(QM)||Sv.push(Mg.key));return Sv.length?g.a(Is,u_Z(e,Sv),0):Is.Iq(0)})};g.z(JL9,Vx);JL9.prototype.K=function(e){return u4(e)?CAL(this,e):ts(e)?aWM(this,e):OM(e)?NpM(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var Kd=[10];g.z(yLJ,Vx);yLJ.prototype.K=function(e){return u4(e)?pYU(this,e):ts(e)?$Ze(this,e):OM(e)?jAN(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var YS=[10];g.z(PAe,Vx);PAe.prototype.K=function(e){return u4(e)?E2e(this,e):ts(e)?XYh(this,e):OM(e)?KeL(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var UZL=[10];g.z(nd,dn);nd.prototype.U8=function(e){var L=dn.prototype.U8.call(this,e);L.musicTrack=new PAe(e,this.X);L.musicPlaylist=new yLJ(e,this.X);L.musicAlbumRelease=new JL9(e,this.X);return L};
nd.prototype.refreshAllStaleEntities=function(e,L){var c=this,I,B,x;return g.Z(function(S){if(S.K==1)return g.a(S,n29(c,e,L),2);if(S.K!=3)return B=I=S.X,x=B.concat,g.a(S,dn.prototype.refreshAllStaleEntities.call(c,e,L),3);I=x.call(B,S.X);return S.return(I)})};g.z(eae,g.Vk);g.M=eae.prototype;g.M.create=function(){var e=this;g.l(this,this.events);if(g.T3(this.XM))this.X=new klL(this.XM,this.player);else if(g.DF(this.XM)||g.Mu(this.XM))this.X=new nd(this.XM,this.player);this.events.C(this.player,"onPlaybackStartExternal",function(){e.CO()});
this.events.C(this.player,"videodatachange",function(){e.CO()});
this.XM.Y("html5_offline_playback_position_sync")&&this.events.C(this.player,"presentingplayerstatechange",this.hC)};
g.M.bC=function(){return!1};
g.M.Gu=function(e,L,c,I){var B=this;return g.Z(function(x){return B.X?x.return(UM(B.X,e,L,c,I)):x.return(Promise.reject())})};
g.M.deleteAll=function(){return this.X.deleteAll()};
g.M.dI=function(e){return this.X.dI(e)};
g.M.refreshAllStaleEntities=function(e){return this.X.refreshAllStaleEntities(e)};
g.M.setUpPositionSyncInterval=function(e){this.X.setUpPositionSyncInterval(e)};
g.M.uI=function(e){this.X.uI(e)};
g.M.MJ=function(e){return this.X.MJ(e)};
g.M.CO=function(){var e=this,L;return g.Z(function(c){L=e.player.getVideoData();return g.uf(L)?LHM(L)&&e.K!==L.clientPlaybackNonce?g.a(c,cGe(e,L),0):c.Iq(0):c.return()})};
g.M.hC=function(e){var L=this,c,I,B,x,S,h,R;return g.Z(function(u){if(u.K==1)return c=L.player.getVideoData(),I=c.FD,g.or(e,2)||g.or(e,512)?g.a(u,eV(),2):u.return();if(u.K!=3){B=u.X;if(!B)return Bg("PES is undefined"),u.return();x=c.videoId;return g.a(u,YU(B,g.dL(x,"mainVideoEntity"),"mainVideoEntity"),3)}S=u.X;if(!S)return u.return();h=Math.floor(I).toString();R={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:h}};return g.a(u,L.Gu([x],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
R),0)})};
g.M.isOrchestrationLeader=function(){return this.X.isOrchestrationLeader()};
g.M.updateDownloadState=function(e,L){var c,I,B,x;return g.Z(function(S){if(S.K==1)return g.a(S,eV(),2);c=S.X;if(!c)return Bg("PES is undefined"),S.return();I=g.QB(e);B=I.entityType;x=I.entityId;return g.a(S,qH(x,B,c,L,!0),0)})};g.JK("offline",eae);})(_yt_player);
